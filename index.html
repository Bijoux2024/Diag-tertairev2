<html lang="fr"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiagTertiaire - Performance Énergétique Tertiaire</title> test101

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin="" src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin="" src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
      /* Global & Reset */
      body { font-family: 'Inter', sans-serif; background-color: #F8F9FA; color: #374151; -webkit-font-smoothing: antialiased; }

      /* Custom Range Slider */
      input[type=range] { -webkit-appearance: none; appearance: none; background: transparent; }
      input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #1E3A5F; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
      input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #E5E7EB; border-radius: 2px; }
      input[type=range]:focus { outline: none; }

      /* Print Styles */
      @media print {
          .no-print { display: none !important; }
          .print-only { display: block !important; }
          body { background: white; }
          .shadow-lg, .shadow-md, .shadow-sm, .shadow-xl { box-shadow: none !important; }
          .break-inside-avoid { break-inside: avoid; }
          .bg-slate-50 { background-color: white !important; }
          nav { display: none; }
      }

      /* Animations */
      .fade-in { animation: fadeIn 0.4s ease-out forwards; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

      .blur-overlay { filter: blur(5px); pointer-events: none; user-select: none; }
    </style>
  </head>
  <body class="antialiased text-[#374151] bg-[#F8F9FA]">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, useRef } = React;
      const RechartsObj = window.Recharts || {};
      const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell, LabelList } = RechartsObj;

      /* --- CONSTANTS & DATA --- */
      const ACTIVITIES = [
          { id: 'office', label: 'Bureaux', icon: 'solar:buildings-2-linear', refKwh: 180 },
          { id: 'retail', label: 'Commerce / Retail', icon: 'solar:shop-linear', refKwh: 350 },
          { id: 'hotel', label: 'Hôtel', icon: 'solar:bed-linear', refKwh: 280 },
          { id: 'health', label: 'Santé', icon: 'solar:heart-pulse-linear', refKwh: 320 },
          { id: 'education', label: 'Enseignement', icon: 'solar:book-linear', refKwh: 150 },
          { id: 'warehouse', label: 'Entrepôt', icon: 'solar:box-linear', refKwh: 90 },
          { id: 'mixed', label: 'Usage mixte', icon: 'solar:transfer-horizontal-linear', refKwh: 220 },
      ];

      const YEARS = [
          { id: 'pre1975', label: 'Avant 1975', sub: 'Isolation souvent absente', coef: 1.45 },
          { id: '1975-1990', label: '1975 – 1990', sub: 'Premières réglementations', coef: 1.28 },
          { id: '1990-2005', label: '1990 – 2005', sub: 'Isolation partielle', coef: 1.12 },
          { id: '2005-2012', label: '2005 – 2012', sub: 'RT 2005', coef: 1.05 },
          { id: 'post2012', label: 'Après 2012', sub: 'RT 2012 ou RE 2020', coef: 1.0 },
      ];

      const HEATING = [
          { id: 'gas', label: 'Chaudière gaz', icon: 'solar:flame-linear' },
          { id: 'elec', label: 'Électrique', icon: 'solar:bolt-linear' },
          { id: 'pac', label: 'Pompe à chaleur', icon: 'solar:water-drops-linear' },
          { id: 'oil', label: 'Fioul', icon: 'solar:fuel-linear' },
          { id: 'ac', label: 'Climatisation rév.', icon: 'solar:snowflake-linear' },
          { id: 'unknown', label: 'Je ne sais pas', icon: 'solar:question-circle-linear' },
      ];

      const OCCUPATION_OPTS = [
          { id: 'semaine', label: 'Semaine uniquement', sub: 'Lun–Ven, ~45h/semaine', icon: 'solar:calendar-linear' },
          { id: '6j', label: '6 jours sur 7', sub: 'Lundi–Samedi', icon: 'solar:calendar-add-linear' },
          { id: '7j', label: '7 jours sur 7', sub: 'Occupation continue', icon: 'solar:refresh-circle-linear' },
          { id: 'etendu', label: 'Horaires étendus', sub: 'Soirs et weekends inclus', icon: 'solar:moon-linear' }
      ];

      const WORKS_LIST = [
          { id: 'roof', label: 'Isolation toiture' },
          { id: 'walls', label: 'Isolation des murs' },
          { id: 'windows', label: 'Remplacement fenêtres' },
          { id: 'heating', label: 'Nouveau système chauffage' },
          { id: 'led', label: 'Passage LED complet' },
          { id: 'regulation', label: 'Régulation / programmation' },
      ];

      const ECS_SYSTEMS = [
          { id: 'elec_ecs', label: 'Chauffe-eau électrique', icon: 'solar:bolt-linear' },
          { id: 'gas_ecs', label: 'Chaudière gaz', icon: 'solar:flame-linear' },
          { id: 'pac_ecs', label: 'PAC eau chaude', icon: 'solar:water-drops-linear' },
          { id: 'solar_ecs', label: 'Solaire thermique', icon: 'solar:sun-linear' },
          { id: 'unknown_ecs', label: 'Je ne sais pas', icon: 'solar:question-circle-linear' },
      ];

      const DEFAULT_FORM = {
          address: '',
          activity: '',
          activityMixPct: 50,
          year: '',
          surface: 300,
          levels: 1,
          heating: '',
          heatingAge: '',
          occupation: '',
          consumptionMode: 'kwh',
          elecKwh: '',
          gasKwh: '',
          elecEuro: '',
          gasEuro: '',
          noData: false,
          works: [],
          hasWorks: 'no',
          ecsSystem: '',
          firstName: '',
          email: '',
          phone: '',
          consent: false
      };

      const LS_KEY = 'diagtertiaire_v1';
      
      
      
      const CTA_CALENDLY_URL = 'https://calendly.com/TON-LIEN'; // à remplacer
const CTA_EMAIL = 'contact@diagtertiaire.fr';

      /* --- HELPERS --- */
      const saveToLS = (data) => {
          try { localStorage.setItem(LS_KEY, JSON.stringify(data)); } catch(e) {}
      };
      const loadFromLS = () => {
          try {
              const d = localStorage.getItem(LS_KEY);
              return d ? JSON.parse(d) : null;
          } catch(e) { return null; }
      };
      const clearLS = () => {
          try { localStorage.removeItem(LS_KEY); } catch(e) {}
      };

      /* --- UI COMPONENTS --- */
      const Icon = ({ icon, className = "" }) => (
          <iconify-icon icon={icon} class={`${className} text-2xl`} style={{ strokeWidth: '1.5' }}></iconify-icon>
      );

      const Button = ({ children, onClick, disabled, variant = 'primary', className = '', type = 'button' }) => {
          const base = "px-6 py-3 rounded-lg font-semibold text-sm transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center gap-2";
          const styles = {
              primary: "bg-[#1E3A5F] text-white hover:bg-[#162B47] focus:ring-[#1E3A5F] disabled:opacity-50 disabled:cursor-not-allowed shadow-sm",
              secondary: "bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 focus:ring-slate-200",
              ghost: "text-slate-500 hover:text-[#1E3A5F]",
              green: "bg-[#2ECC71] text-white hover:bg-[#27AE60] focus:ring-[#2ECC71] shadow-sm"
          };
          return (
              <button type={type} onClick={onClick} disabled={disabled} className={`${base} ${styles[variant]} ${className}`}>
                  {children}
              </button>
          );
      };

      const CardSelect = ({ selected, onClick, icon, label, sub }) => (
          <div
              onClick={onClick}
              className={`cursor-pointer border rounded-xl p-4 transition-all duration-200 flex flex-col items-center text-center gap-3 h-full relative group
              ${selected ? 'bg-[#EEF2FF] border-[#1E3A5F] border-[2px] shadow-sm' : 'bg-white border-slate-200 hover:border-[#1E3A5F]/50 hover:shadow-sm'}`}
          >
              <div className={`p-2 rounded-full transition-colors ${selected ? 'bg-[#1E3A5F] text-white' : 'bg-slate-100 text-slate-400 group-hover:text-slate-600'}`}>
                  <Icon icon={icon} />
              </div>
              <div>
                  <div className={`text-sm ${selected ? 'font-semibold text-[#1E3A5F]' : 'font-medium text-slate-600'}`}>{label}</div>
                  {sub && <div className="text-xs text-slate-400 mt-1 leading-tight">{sub}</div>}
              </div>
          </div>
      );

      const RadioFull = ({ selected, onClick, label, sub }) => (
          <div onClick={onClick} className={`cursor-pointer border rounded-lg p-3 flex items-center justify-between transition-all ${selected ? 'border-[#1E3A5F] bg-[#EEF2FF] border-[2px]' : 'border-slate-200 bg-white hover:bg-slate-50'}`}>
              <div className="flex flex-col">
                  <span className={`text-sm ${selected ? 'font-semibold text-[#1E3A5F]' : 'font-medium text-slate-700'}`}>{label}</span>
                  <span className="text-xs text-slate-400 italic">{sub}</span>
              </div>
              <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${selected ? 'border-[#1E3A5F]' : 'border-slate-300'}`}>
                  {selected && <div className="w-2.5 h-2.5 rounded-full bg-[#1E3A5F]"></div>}
              </div>
          </div>
      );

      const SectionCard = ({ children, className = "" }) => (
          <div className={`bg-white rounded-xl shadow-md border border-slate-100 p-4 md:p-8 ${className}`}>
              {children}
          </div>
      );

      const Input = ({ type = "text", value, onChange, placeholder, label, suffix, min, max, note }) => (
          <div className="flex flex-col gap-2 w-full">
              {label && <label className="text-sm font-medium text-[#374151]">{label}</label>}
              <div className="relative">
                  <input
                      type={type} value={value} onChange={onChange} placeholder={placeholder} min={min} max={max}
                      className="w-full border border-slate-300 rounded-lg px-4 py-2.5 text-sm focus:border-[#1E3A5F] focus:ring-1 focus:ring-[#1E3A5F] outline-none transition-colors text-[#1E3A5F]"
                  />
                  {suffix && <span className="absolute right-4 top-2.5 text-sm text-slate-400">{suffix}</span>}
              </div>
              {note && <p className="text-sm text-[#9CA3AF] italic">{note}</p>}
          </div>
      );

      const Stepper = ({ currentStep }) => {
          const steps = [
              { id: 1, label: 'Bâtiment', pct: 25 },
              { id: 2, label: 'Énergie', pct: 50 },
              { id: 3, label: 'Contact', pct: 75 },
              { id: 4, label: 'Rapport', pct: 100 }
          ];
          const progressPercentage = steps.find(s => s.id === currentStep)?.pct || 25;

          return (
              <div className="mb-8 no-print w-full max-w-2xl mx-auto">
                  <div className="flex justify-between mb-3 px-1">
                      {steps.map((s) => (
                          <div key={s.id} className={`text-xs font-semibold tracking-wide transition-colors ${s.id <= currentStep ? 'text-[#1E3A5F]' : 'text-slate-300'}`}>
                              {s.label.toUpperCase()}
                          </div>
                      ))}
                  </div>
                  <div className="h-1 bg-[#E5E7EB] rounded-full w-full overflow-hidden">
                      <div
                          className="h-full bg-[#1E3A5F] transition-all duration-500 ease-out rounded-full"
                          style={{ width: `${progressPercentage}%` }}
                      ></div>
                  </div>
              </div>
          );
      };

      const FormHeader = ({ title, subtitle }) => (
          <div className="bg-white border-b border-slate-100 pb-6 mb-6 text-center">
              <h2 className="text-2xl tracking-tight font-semibold text-[#1E3A5F] mb-2">{title}</h2>
              <p className="text-[#6B7280]">{subtitle}</p>
          </div>
      );

      const SectionTitle = ({ children, sub }) => (
          <div className="text-center mb-10">
              <h2 className="text-2xl md:text-3xl tracking-tight font-semibold text-[#1E3A5F] mb-2">{children}</h2>
              {sub && <p className="text-[#6B7280] text-sm">{sub}</p>}
          </div>
      );

      /* --- CHART ERROR BOUNDARY --- */
      class ChartErrorBoundary extends React.Component {
          constructor(props) { super(props); this.state = { hasError: false }; }
          static getDerivedStateFromError(error) { return { hasError: true }; }
          render() {
              if (this.state.hasError) {
                  return (
                      <div className="h-64 flex flex-col items-center justify-center bg-slate-50 rounded-xl border border-slate-200 text-center p-6">
                          <Icon icon="solar:chart-2-linear" className="text-slate-300 mb-3" />
                          <p className="text-slate-500 font-medium text-sm mb-2">Graphique indisponible</p>
                          <p className="text-slate-400 text-xs">Valeurs disponibles en texte ci-dessous</p>
                          {this.props.fallbackData && (
                              <div className="mt-4 flex flex-col gap-1 w-full max-w-xs">
                                  {this.props.fallbackData.map((d, i) => (
                                      <div key={i} className="flex justify-between text-xs bg-white border border-slate-100 rounded px-3 py-1.5">
                                          <span className="text-slate-600">{d.name}</span>
                                          <span className="font-semibold text-[#1E3A5F]">{d.val} kWh/m²</span>
                                      </div>
                                  ))}
                              </div>
                          )}
                      </div>
                  );
              }
              return this.props.children;
          }
      }

      /* --- PDF EXPORT --- */

      

const exportPDF = async (data, analysis = {}) => {
  // Construire le HTML
  const htmlContent = buildPDFHtml(data, analysis);
  
  // Appeler PDFShift
  try {
    const response = await fetch("/api/pdf", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
     body: JSON.stringify({
  html: htmlContent,
  filename: `DiagTertiaire_rapport_${new Date().toISOString().slice(0, 10)}.pdf`
})
    });
    
if (!response.ok) {
  const err = await response.json().catch(() => ({}));
  console.error("Erreur PDF:", err);
  alert("Erreur export PDF: " + (err.details || err.error || "inconnue"));
  return;
}

const blob = await response.blob();
const url = window.URL.createObjectURL(blob);

const a = document.createElement("a");
a.href = url;
a.download = "rapport-diagnostic.pdf";
document.body.appendChild(a);
a.click();
a.remove();

window.URL.revokeObjectURL(url);
    
  } catch (error) {
    console.error('Erreur génération PDF:', error);
    alert('Erreur lors de la génération du PDF. Vérifiez votre clé API PDFShift.');
  }
};

   

      const MiniDPEGauge = ({ kwhPerM2, dpeLabel, dpeColor }) => (
          <div className="bg-white rounded-xl border border-slate-100 p-5 shadow-sm">
              <div className="flex items-center justify-between mb-4">
                  <span className="text-sm font-semibold text-[#1E3A5F]">Classe énergétique estimée</span>
                  <span className="text-xs text-slate-400 italic">ordre de grandeur</span>
              </div>
              <div className="flex gap-1.5 items-end mb-3">
                  {['A','B','C','D','E','F','G'].map((l, i) => {
                      const colors = ['#1A9E5C','#4CB84C','#B2D24F','#F5E54A','#F5A623','#E8622A','#D4252A'];
                      const heights = ['h-4','h-6','h-8','h-10','h-12','h-14','h-16'];
                      const isActive = l === dpeLabel;
                      return (
                          <div key={l}
                              className={`flex-1 ${heights[i]} rounded-sm flex items-center justify-center text-xs font-semibold transition-all ${isActive ? 'ring-2 ring-offset-1 ring-[#1E3A5F] scale-110' : 'opacity-60'}`}
                              style={{ backgroundColor: colors[i], color: i < 3 ? '#1a1a1a' : '#fff' }}
                          >
                              {l}
                          </div>
                      );
                  })}
              </div>
              <div className="text-center">
                  <span className="text-2xl tracking-tight font-semibold" style={{ color: dpeColor }}>{dpeLabel}</span>
                  <span className="text-slate-500 text-sm ml-2">• {kwhPerM2} kWh/m²/an</span>
              </div>
          </div>
      );
const StepBuilding = ({ data, update, onNext }) => {
  const isValid = data.activity && data.year && Number(data.surface) > 0;

  return (
    <div className="fade-in max-w-3xl mx-auto">
      <SectionCard>
        <FormHeader
          title="Décrivez votre bâtiment"
          subtitle="Quelques informations suffisent pour une première estimation"
        />

        <div className="space-y-8">
          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Type d'activité</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              {ACTIVITIES.map((a) => (
                <CardSelect
                  key={a.id}
                  selected={data.activity === a.id}
                  onClick={() => update('activity', a.id)}
                  icon={a.icon}
                  label={a.label}
                />
              ))}
            </div>

            {data.activity === 'mixed' && (
              <div className="mt-4 bg-slate-50 border border-slate-200 rounded-xl p-4">
                <div className="flex items-center justify-between mb-2">
                  <label className="text-sm font-medium text-slate-700">
                    Répartition Bureaux / Commerce
                  </label>
                  <span className="text-xs text-slate-500">
                    Bureaux {data.activityMixPct}% • Commerce {100 - (data.activityMixPct || 0)}%
                  </span>
                </div>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={data.activityMixPct ?? 50}
                  onChange={(e) => update('activityMixPct', Number(e.target.value))}
                  className="w-full"
                />
              </div>
            )}
          </div>

          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Période de construction</h3>
            <div className="grid md:grid-cols-2 gap-3">
              {YEARS.map((y) => (
                <RadioFull
                  key={y.id}
                  selected={data.year === y.id}
                  onClick={() => update('year', y.id)}
                  label={y.label}
                  sub={y.sub}
                />
              ))}
            </div>
          </div>

          <div className="grid md:grid-cols-2 gap-4">
            <Input
              type="number"
              label="Surface totale"
              suffix="m²"
              min={1}
              value={data.surface}
              onChange={(e) => update('surface', Number(e.target.value || 0))}
              placeholder="Ex: 300"
            />
            <Input
              type="number"
              label="Nombre de niveaux"
              min={1}
              value={data.levels}
              onChange={(e) => update('levels', Number(e.target.value || 1))}
              placeholder="Ex: 1"
            />
          </div>

          <div className="flex justify-end">
            <Button onClick={onNext} disabled={!isValid}>
              Continuer →
            </Button>
          </div>
        </div>
      </SectionCard>
    </div>
  );
};

const StepEnergy = ({ data, update, onNext, onBack }) => {
  const hasEnergyData =
    data.noData ||
    (data.consumptionMode === 'kwh'
      ? (Number(data.elecKwh || 0) + Number(data.gasKwh || 0) > 0)
      : (Number(data.elecEuro || 0) + Number(data.gasEuro || 0) > 0));

  const isValid =
    data.heating &&
    data.heatingAge &&
    data.occupation &&
    data.hasWorks &&
    (data.noData || hasEnergyData);

  const toggleWork = (workId) => {
    const current = Array.isArray(data.works) ? data.works : [];
    if (current.includes(workId)) {
      update('works', current.filter((id) => id !== workId));
    } else {
      update('works', [...current, workId]);
    }
  };

  return (
    <div className="fade-in max-w-3xl mx-auto">
      <SectionCard>
        <FormHeader
          title="Vos équipements et consommations"
          subtitle="On affine l’estimation énergétique et les priorités d’action"
        />

        <div className="space-y-8">
          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Système de chauffage principal</h3>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
              {HEATING.map((h) => (
                <CardSelect
                  key={h.id}
                  selected={data.heating === h.id}
                  onClick={() => update('heating', h.id)}
                  icon={h.icon}
                  label={h.label}
                />
              ))}
            </div>
          </div>

          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Âge du système de chauffage</h3>
            <div className="grid md:grid-cols-3 gap-3">
              {['< 5 ans', '5 à 15 ans', '> 15 ans'].map((age) => (
                <RadioFull
                  key={age}
                  selected={data.heatingAge === age}
                  onClick={() => update('heatingAge', age)}
                  label={age}
                  sub={age === '> 15 ans' ? 'Souvent moins performant' : ' '}
                />
              ))}
            </div>
          </div>

          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Occupation du bâtiment</h3>
            <div className="grid md:grid-cols-2 gap-3">
              {OCCUPATION_OPTS.map((o) => (
                <CardSelect
                  key={o.id}
                  selected={data.occupation === o.id}
                  onClick={() => update('occupation', o.id)}
                  icon={o.icon}
                  label={o.label}
                  sub={o.sub}
                />
              ))}
            </div>
          </div>

          <div className="border border-slate-200 rounded-xl p-4 bg-slate-50">
            <div className="flex items-center justify-between gap-3 mb-3">
              <h3 className="text-sm font-semibold text-[#1E3A5F]">Consommation annuelle</h3>
              <label className="flex items-center gap-2 text-xs text-slate-600 cursor-pointer">
                <input
                  type="checkbox"
                  checked={!!data.noData}
                  onChange={(e) => update('noData', e.target.checked)}
                />
                Je n’ai pas mes données (estimation automatique)
              </label>
            </div>

            {!data.noData && (
              <>
                <div className="flex gap-2 mb-4">
                  <button
                    type="button"
                    onClick={() => update('consumptionMode', 'kwh')}
                    className={`px-3 py-1.5 rounded-lg text-xs font-semibold border ${
                      data.consumptionMode === 'kwh'
                        ? 'bg-[#1E3A5F] text-white border-[#1E3A5F]'
                        : 'bg-white text-slate-600 border-slate-300'
                    }`}
                  >
                    En kWh
                  </button>
                  <button
                    type="button"
                    onClick={() => update('consumptionMode', 'euro')}
                    className={`px-3 py-1.5 rounded-lg text-xs font-semibold border ${
                      data.consumptionMode === 'euro'
                        ? 'bg-[#1E3A5F] text-white border-[#1E3A5F]'
                        : 'bg-white text-slate-600 border-slate-300'
                    }`}
                  >
                    En €
                  </button>
                </div>

                {data.consumptionMode === 'kwh' ? (
                  <div className="grid md:grid-cols-2 gap-4">
                    <Input
                      type="number"
                      label="Électricité"
                      suffix="kWh/an"
                      value={data.elecKwh}
                      onChange={(e) => update('elecKwh', e.target.value)}
                      placeholder="Ex: 45000"
                    />
                    <Input
                      type="number"
                      label="Gaz"
                      suffix="kWh/an"
                      value={data.gasKwh}
                      onChange={(e) => update('gasKwh', e.target.value)}
                      placeholder="Ex: 120000"
                    />
                  </div>
                ) : (
                  <div className="grid md:grid-cols-2 gap-4">
                    <Input
                      type="number"
                      label="Facture électricité"
                      suffix="€/an"
                      value={data.elecEuro}
                      onChange={(e) => update('elecEuro', e.target.value)}
                      placeholder="Ex: 12000"
                    />
                    <Input
                      type="number"
                      label="Facture gaz"
                      suffix="€/an"
                      value={data.gasEuro}
                      onChange={(e) => update('gasEuro', e.target.value)}
                      placeholder="Ex: 8000"
                    />
                  </div>
                )}
              </>
            )}
          </div>

          <div>
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Des travaux ont-ils déjà été réalisés ?</h3>
            <div className="grid md:grid-cols-2 gap-3 mb-3">
              <RadioFull
                selected={data.hasWorks === 'no'}
                onClick={() => {
                  update('hasWorks', 'no');
                  update('works', []);
                }}
                label="Non"
                sub="Aucun poste significatif récemment"
              />
              <RadioFull
                selected={data.hasWorks === 'yes'}
                onClick={() => update('hasWorks', 'yes')}
                label="Oui"
                sub="Je sélectionne les postes déjà traités"
              />
            </div>

            {data.hasWorks === 'yes' && (
              <div className="grid md:grid-cols-2 gap-2">
                {WORKS_LIST.map((w) => {
                  const checked = (data.works || []).includes(w.id);
                  return (
                    <label
                      key={w.id}
                      className={`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors ${
                        checked
                          ? 'bg-[#EEF2FF] border-[#1E3A5F]'
                          : 'bg-white border-slate-200 hover:bg-slate-50'
                      }`}
                    >
                      <input
                        type="checkbox"
                        checked={checked}
                        onChange={() => toggleWork(w.id)}
                      />
                      <span className="text-sm text-slate-700">{w.label}</span>
                    </label>
                  );
                })}
              </div>
            )}
          </div>

          <div className="flex items-center justify-between pt-2">
            <button
              type="button"
              onClick={onBack}
              className="text-slate-500 hover:text-slate-700 text-sm font-medium"
            >
              ← Retour
            </button>

            <Button onClick={onNext} disabled={!isValid}>
              Continuer →
            </Button>
          </div>
        </div>
      </SectionCard>
    </div>
  );
};
      const StepLead = ({ data, update, onNext, onBack }) => {
          const isValid = data.firstName && data.email && data.consent;

          const activityRef = ACTIVITIES.find(a => a.id === data.activity) || ACTIVITIES[0];
          const yearRef = YEARS.find(y => y.id === data.year) || YEARS[0];
          const getMixedRef = (pct) => Math.round((180 * pct / 100) + (350 * (100 - pct) / 100));
          const refBase = data.activity === 'mixed' ? getMixedRef(data.activityMixPct) : activityRef.refKwh;

          const sysCoef = data.heatingAge === '> 15 ans' ? 1.15 : data.heatingAge === '5 à 15 ans' ? 1.05 : 1.1;
          let consumptionTotalKwh = 0;

          if (data.noData) {
              consumptionTotalKwh = refBase * data.surface * yearRef.coef * sysCoef;
          } else {
              consumptionTotalKwh = data.consumptionMode === 'kwh'
                  ? (parseFloat(data.elecKwh)||0) + (parseFloat(data.gasKwh)||0)
                  : ((parseFloat(data.elecEuro)||0)/0.25) + ((parseFloat(data.gasEuro)||0)/0.12);
              if (consumptionTotalKwh === 0) consumptionTotalKwh = refBase * data.surface * yearRef.coef * sysCoef;
          }

        const kwhPerM2 = Math.round(consumptionTotalKwh / data.surface);
const dpe = getDPE(kwhPerM2);

          return (
              <div className="fade-in max-w-lg mx-auto space-y-6">
                  <div className="space-y-3">
                      <MiniDPEGauge kwhPerM2={kwhPerM2} dpeLabel={dpe.l} dpeColor={dpe.c} />

                      <div className="relative rounded-xl overflow-hidden border border-slate-100 shadow-sm">
                          <div className="blur-overlay bg-white p-5 space-y-3">
                              {[1,2,3].map(i => (
                                  <div key={i} className="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100">
                                      <div className="w-8 h-8 rounded-full bg-[#1E3A5F]/20 flex-shrink-0"></div>
                                      <div className="space-y-1.5 flex-1">
                                          <div className="h-3 bg-slate-200 rounded w-3/4"></div>
                                          <div className="h-2.5 bg-slate-100 rounded w-1/2"></div>
                                      </div>
                                      <div className="h-6 w-16 bg-green-100 rounded"></div>
                                  </div>
                              ))}
                          </div>
                          <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/60 backdrop-blur-sm">
                              <div className="bg-[#1E3A5F] text-white rounded-xl px-5 py-4 text-center shadow-lg max-w-xs mx-4">
                                  <Icon icon="solar:lock-keyhole-linear" className="mb-2 block mx-auto text-3xl" />
                                  <p className="font-semibold text-sm mb-1">Débloquez vos 3 priorités</p>
                                  <p className="text-xs text-blue-200">Entrez votre email ci-dessous pour accéder au rapport complet et au plan d'action personnalisé.</p>
                              </div>
                          </div>
                      </div>
                  </div>

                  <SectionCard>
                      <div className="text-center space-y-2 mb-6">
                          <div className="w-16 h-16 bg-[#2ECC71]/10 rounded-full flex items-center justify-center mx-auto mb-4 text-[#2ECC71]">
                              <Icon icon="solar:document-check-linear" className="text-4xl" />
                          </div>
                          <h2 className="text-2xl tracking-tight font-semibold text-[#1E3A5F]">Votre estimation est prête</h2>
                          <p className="text-[#6B7280]">Entrez votre email pour accéder à votre rapport complet et recevoir un plan d'action concret.</p>
                      </div>

                      <div className="space-y-5">
                          <Input label="Prénom" placeholder="Votre prénom" value={data.firstName} onChange={(e) => update('firstName', e.target.value)} />
                          <Input type="email" label="Email professionnel" placeholder="vous@entreprise.com" value={data.email} onChange={(e) => update('email', e.target.value)} />
                          <Input type="tel" label="Téléphone (optionnel)" placeholder="06 XX XX XX XX" value={data.phone} onChange={(e) => update('phone', e.target.value)} note="Pour être recontacté si vous le souhaitez" />

                          <label className="flex gap-3 items-start cursor-pointer group p-3 border border-transparent hover:bg-slate-50 rounded-lg transition-colors">
                              <div className="relative flex items-center mt-0.5">
                                  <input
                                      type="checkbox" checked={data.consent} onChange={(e) => update('consent', e.target.checked)}
                                      className="peer h-4 w-4 cursor-pointer appearance-none rounded border border-slate-300 bg-white checked:border-[#1E3A5F] checked:bg-[#1E3A5F] transition-all"
                                  />
                                  <Icon icon="solar:check-linear" className="absolute left-0 top-0 text-white opacity-0 peer-checked:opacity-100 pointer-events-none text-xs" />
                              </div>
                              <span className="text-xs text-slate-500 leading-relaxed group-hover:text-slate-700">
                                  J'accepte de recevoir mon rapport et des recommandations sur la rénovation énergétique. Désabonnement en 1 clic.
                              </span>
                          </label>

                          <Button onClick={onNext} disabled={!isValid} className="w-full justify-center text-base py-4 shadow-lg shadow-[#1E3A5F]/20">
                              Accéder à mon rapport →
                          </Button>
                      </div>
                  </SectionCard>

                  <div className="flex justify-center">
                      <button type="button" onClick={onBack} className="text-slate-400 text-sm hover:text-slate-600 font-medium">Retour</button>
                  </div>
              </div>
          );
      };
      /* --- REPORT ENGINE (source unique de calculs rapport écran + PDF) --- */

const ENERGY_PRICES = {
  elec: 0.25,        // Prix TTC réaliste 2026
  gas: 0.12,         // Prix TTC réaliste 2026 (corrigé)
  oil: 0.13,
  pac: 0.10,
  ac: 0.18,
  unknown: 0.18
};

const formatInt = (v) => Math.round(Number(v || 0)).toLocaleString('fr-FR');
const formatEuro = (v) => `${formatInt(v)} €`;
const formatRangeEuro = (min, max) => `${formatInt(min)} - ${formatInt(max)} €`;

const formatRoiYears = (cost, annualSaving) => {
  const c = Number(cost || 0);
  const s = Number(annualSaving || 0);

  if (s <= 0) return 'Non calculable';

  const roi = c / s;
  if (roi < 0.1) return '< 0,1 an';
  if (roi < 2) return `${roi.toFixed(1).replace('.', ',')} an`;
  return `${roi.toFixed(1).replace('.', ',')} ans`;
};

const getEnergyPrice = (heatingId) => {
  return ENERGY_PRICES[heatingId] ?? ENERGY_PRICES.unknown;
};

const getHeatingLabel = (heatingId) => {
  const h = HEATING.find(x => x.id === heatingId);
  return h ? h.label : 'Non précisé';
};

const getOccupationLabel = (occId) => {
  const o = OCCUPATION_OPTS.find(x => x.id === occId);
  return o ? o.label : 'Non précisé';
};

const getMixedRef = (pct = 50) => {
  // Conservé volontairement simple (bureaux + retail)
  return Math.round((180 * pct / 100) + (350 * (100 - pct) / 100));
};

const parseCostRange = (costStr) => {
  if (!costStr || typeof costStr !== 'string') return { min: 0, max: 0 };

  // Exemples gérés :
  // "6 000 - 25 000 €"
  // "6 000 à 25 000 €"
  // "1500-8000 €"
  const nums = String(costStr)
    .replace(/[€]/g, '')
    .replace(/à/gi, ' ')
    .replace(/[–-]/g, ' ')
    .replace(/\s+/g, ' ')
    .trim()
    .match(/\d+/g);

  if (!nums || nums.length === 0) return { min: 0, max: 0 };

  const values = nums.map(Number);

  // Cas "6 000 25 000" -> [6,000,25,000]
  if (values.length === 4 && values[1] < 1000 && values[3] < 1000) {
    return {
      min: values[0] * 1000 + values[1],
      max: values[2] * 1000 + values[3]
    };
  }

  if (values.length >= 2) {
    return {
      min: Math.min(...values),
      max: Math.max(...values)
    };
  }

  return { min: values[0], max: values[0] };
};

const estimateAidRanges = (priorityId, surface, isDecretEligible) => {
  // Fourchettes prudentes et génériques (non contractuelles)
  let cee = null;
  let mpr = null;
  let decret = null;

  if (priorityId === 'roof') {
    cee = {
      min: surface * 8,
      max: surface * 22,
      label: `CEE : ${formatRangeEuro(surface * 8, surface * 22)}`
    };
    mpr = {
      label: `MaPrimeRénov' : montant variable selon statut et éligibilité`
    };
  }

  if (priorityId === 'windows') {
    cee = {
      min: surface * 4,
      max: surface * 12,
      label: `CEE : ${formatRangeEuro(surface * 4, surface * 12)}`
    };
    mpr = {
      label: `MaPrimeRénov' : montant variable selon statut et éligibilité`
    };
  }

  if (priorityId === 'heating') {
    cee = {
      min: 1500,
      max: 8000,
      label: `CEE : ${formatRangeEuro(1500, 8000)}`
    };
    mpr = {
      label: `MaPrimeRénov' : montant variable selon statut et éligibilité`
    };
  }

  if (priorityId === 'regulation' || priorityId === 'gtb') {
    cee = {
      min: 800,
      max: 4000,
      label: `CEE : ${formatRangeEuro(800, 4000)}`
    };
    mpr = {
      label: `MaPrimeRénov' : généralement non prioritaire / à vérifier`
    };
  }

  if (priorityId === 'led') {
    cee = {
      min: 500,
      max: 2500,
      label: `CEE : ${formatRangeEuro(500, 2500)}`
    };
    mpr = {
      label: `MaPrimeRénov' : généralement non applicable`
    };
  }

  if (isDecretEligible) {
    decret = {
      label: `Bâtiment potentiellement soumis au Décret Tertiaire (analyse de conformité à prévoir)`
    };
  }

  return { cee, mpr, decret };
};
const getDPE = (val) => {
  if (val <= 70) return { l: 'A', c: '#1A9E5C', w: '40%' };
  if (val <= 110) return { l: 'B', c: '#4CB84C', w: '48%' };
  if (val <= 180) return { l: 'C', c: '#B2D24F', w: '56%' };
  if (val <= 250) return { l: 'D', c: '#F5E54A', w: '64%' };
  if (val <= 330) return { l: 'E', c: '#F5A623', w: '72%' };
  if (val <= 420) return { l: 'F', c: '#E8622A', w: '80%' };
  return { l: 'G', c: '#D4252A', w: '88%' };
};
// Fonction pour générer le HTML du PDF - À UTILISER AVEC PDFSHIFT
const buildPDFHtml = (data, analysis) => {
  const { priorities, kwhPerM2, refBase, dpe, activityRef, yearRef, heatingLabel } = analysis;
  
  return `
    <!DOCTYPE html>
    <html lang="fr">
      <head>
        <meta charset="UTF-8">
        <style>
          @page { size: A4; margin: 0; }
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            font-size: 10pt;
            color: #374151;
            line-height: 1.4;
          }
          .page { 
            width: 210mm; 
            min-height: 297mm; 
            padding: 20mm 15mm;
            page-break-after: always;
            position: relative;
          }
          
          .header { 
            background: #1E3A5F; 
            color: white; 
            padding: 20px; 
            border-radius: 8px;
            margin-bottom: 20px;
          }
          .header h1 { 
            font-size: 18pt; 
            margin-bottom: 5px;
            font-weight: 700;
          }
          .header p { 
            font-size: 9pt; 
            opacity: 0.8; 
          }
          
          .info-box {
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
          }
          .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
          }
          .info-item { font-size: 9pt; }
          .info-label { 
            color: #64748B; 
            margin-bottom: 3px;
            font-size: 8pt;
          }
          .info-value { 
            font-weight: 600; 
            color: #1E3A5F; 
          }
          
          .section-title {
            font-size: 12pt;
            font-weight: 700;
            color: #1E3A5F;
            margin: 20px 0 10px;
          }
          
          .dpe-gauge { margin: 15px 0; }
          .dpe-bar {
            display: flex;
            align-items: center;
            height: 28px;
            border-radius: 4px;
            padding: 0 10px;
            color: white;
            font-weight: 700;
            margin-bottom: 3px;
            font-size: 11pt;
          }
          .dpe-A { background: #1A9E5C; width: 120px; }
          .dpe-B { background: #4CB84C; width: 150px; }
          .dpe-C { background: #B2D24F; width: 180px; }
          .dpe-D { background: #F5E54A; width: 210px; color: #1a1a1a; }
          .dpe-E { background: #F5A623; width: 240px; }
          .dpe-F { background: #E8622A; width: 270px; }
          .dpe-G { background: #D4252A; width: 300px; }
          .dpe-active {
            border: 3px solid #1E3A5F;
            position: relative;
            box-shadow: 0 2px 8px rgba(30, 58, 95, 0.2);
          }
          .dpe-value {
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 2px solid #1E3A5F;
            padding: 5px 12px;
            border-radius: 4px;
            color: #1E3A5F;
            font-weight: 700;
            white-space: nowrap;
            font-size: 10pt;
          }
          
          .action-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-left: 4px solid #3B82F6;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            page-break-inside: avoid;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
          }
          .action-title {
            font-size: 11pt;
            font-weight: 700;
            color: #1E3A5F;
            margin-bottom: 5px;
          }
          .action-tag {
            display: inline-block;
            background: #EEF2FF;
            color: #3B82F6;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 7pt;
            font-weight: 600;
            margin-bottom: 10px;
          }
          .action-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
          }
          .action-metric { font-size: 8pt; }
          .action-label {
            color: #64748B;
            margin-bottom: 3px;
            font-size: 7pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          }
          .action-value {
            font-weight: 700;
            color: #1E3A5F;
            font-size: 10pt;
          }
          .action-gain { color: #2ECC71; }
          
          .aids-box {
            background: #FFF9E6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 12px;
            border-left: 3px solid #F59E0B;
          }
          .aids-title {
            font-size: 8pt;
            font-weight: 700;
            color: #92400E;
            margin-bottom: 5px;
          }
          .aids-item {
            font-size: 7.5pt;
            color: #92400E;
            margin-bottom: 3px;
            line-height: 1.4;
          }
          
          .cta-box {
            background: #1E3A5F;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
          }
          .cta-title {
            font-size: 11pt;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
          }
          .cta-list {
            text-align: left;
            margin: 10px 0;
            font-size: 8pt;
            line-height: 1.6;
          }
          
          .footer {
            position: absolute;
            bottom: 15mm;
            left: 15mm;
            right: 15mm;
            border-top: 1px solid #E2E8F0;
            padding-top: 10px;
            font-size: 7pt;
            color: #94A3B8;
            display: flex;
            justify-content: space-between;
          }
          
          .hypotheses-list {
            font-size: 8pt;
            color: #64748B;
            line-height: 1.6;
          }
          .hypotheses-list li { margin-bottom: 5px; }
        </style>
      </head>
      <body>
        <div class="page">
          <div class="header">
            <h1>Rapport DiagTertiaire</h1>
            <p>Diagnostic énergétique simplifié - Rapport d'aide à la décision</p>
          </div>
          
          <div class="info-box">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Activité</div>
                <div class="info-value">${activityRef.label}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Surface</div>
                <div class="info-value">${data.surface} m²</div>
              </div>
              <div class="info-item">
                <div class="info-label">Année</div>
                <div class="info-value">${yearRef.label}</div>
              </div>
              <div class="info-item">
                <div class="info-label">Chauffage</div>
                <div class="info-value">${heatingLabel}</div>
              </div>
            </div>
          </div>
          
          <h2 class="section-title">Synthèse de performance</h2>
          
          <div class="dpe-gauge">
            ${['A', 'B', 'C', 'D', 'E', 'F', 'G'].map(letter => `
              <div class="dpe-bar dpe-${letter} ${dpe.l === letter ? 'dpe-active' : ''}">
                ${letter}
                ${dpe.l === letter ? `<span class="dpe-value">${kwhPerM2} kWh/m²/an</span>` : ''}
              </div>
            `).join('')}
          </div>
          
          <div class="info-box" style="margin-top: 20px;">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Référence sectorielle</div>
                <div class="info-value">${refBase} kWh/m²/an</div>
              </div>
              <div class="info-item">
                <div class="info-label">Objectif de performance</div>
                <div class="info-value" style="color: #2ECC71;">${Math.round(refBase * 0.8)} kWh/m²/an</div>
              </div>
            </div>
          </div>
          
          <h2 class="section-title">Hypothèses de calcul</h2>
          <ul class="hypotheses-list">
            <li>Prix énergie (TTC) : ${heatingLabel.includes('gaz') ? 'Gaz' : 'Électricité'} = ${analysis.avgPrice.toFixed(2)} €/kWh</li>
            <li>Référence : ${activityRef.label} = ${refBase} kWh/m²/an (ADEME)</li>
            <li>Objectif : 80% de la référence sectorielle</li>
            <li>Coûts : base marché 2026 (±30%)</li>
          </ul>
          
          <div class="footer">
            <span>DiagTertiaire - ${new Date().toLocaleDateString('fr-FR')}</span>
            <span>Page 1/2</span>
          </div>
        </div>
        
        <div class="page">
          <h2 class="section-title">Plan d'actions priorisé</h2>
          <p style="font-size: 8pt; color: #64748B; margin-bottom: 15px;">
            Recommandations à confirmer par visite technique.
          </p>
          
          ${priorities.slice(0, 3).map((p, i) => `
            <div class="action-card">
              <div class="action-title">${i + 1}. ${p.title}</div>
              <div class="action-tag">${p.tag}</div>
              
              <div class="action-grid">
                <div class="action-metric">
                  <div class="action-label">Économies énergie</div>
                  <div class="action-value">${p.gainKwhVal.toLocaleString('fr-FR')} kWh/an</div>
                </div>
                <div class="action-metric">
                  <div class="action-label">Gain financier</div>
                  <div class="action-value action-gain">${p.gainEuro.toLocaleString('fr-FR')} €/an</div>
                </div>
                <div class="action-metric">
                  <div class="action-label">Coût estimatif</div>
                  <div class="action-value">${p.costMin.toLocaleString('fr-FR')} à ${p.costMax.toLocaleString('fr-FR')} €</div>
                </div>
                <div class="action-metric">
                  <div class="action-label">ROI (hors aides)</div>
                  <div class="action-value">
                    ${(() => {
                      const gain = p.gainEuro || 0;
                      if (!gain) return "À estimer";
                      const roiMin = Math.round((p.costMin / gain) * 10) / 10;
                      const roiMax = Math.round((p.costMax / gain) * 10) / 10;
                      return roiMin.toLocaleString('fr-FR') + ' à ' + roiMax.toLocaleString('fr-FR') + ' ans';
                    })()}
                  </div>
                </div>
              </div>
              
              <div class="aids-box">
                <div class="aids-title">💸 Aides indicatives</div>
                <div class="aids-item">• CEE : ${p.aids?.cee?.label?.replace(/^CEE\s*:\s*/i, "") || "À estimer"}</div>
                <div class="aids-item">• MaPrimeRénov' : ${p.aids?.mpr?.label?.replace(/^MaPrimeRénov'\s*:\s*/i, "") || "À vérifier"}</div>
              </div>
            </div>
          `).join('')}
          
          <div class="cta-box">
            <div class="cta-title">VALIDATION AVEC UN EXPERT</div>
            <div class="cta-list">
              15 minutes offertes :<br>
              • Valider les priorités<br>
              • Estimer les aides<br>
              • Orienter vers les bons interlocuteurs
            </div>
            <p style="margin-top: 12px; font-weight: 600;">
              📅 diagtertiaire.fr/rdv | contact@diagtertiaire.fr
            </p>
          </div>
          
          <div class="footer">
            <span>DiagTertiaire - ${new Date().toLocaleDateString('fr-FR')}</span>
            <span>Page 2/2</span>
          </div>
        </div>
      </body>
    </html>
  `;
};
const buildReportData = (data) => {
  const activityRef = ACTIVITIES.find(a => a.id === data.activity) || ACTIVITIES[0];
  const yearRef = YEARS.find(y => y.id === data.year) || YEARS[0];

  const refBase = data.activity === 'mixed'
    ? getMixedRef(data.activityMixPct || 50)
    : activityRef.refKwh;

  const heatingLabel = getHeatingLabel(data.heating);
  const occupationLabel = getOccupationLabel(data.occupation);

  // Prix énergie (corrigé)
  const avgPrice = getEnergyPrice(data.heating);

  // Calcul consommation totale
  let sysCoef = data.heatingAge === '> 15 ans' ? 1.15 : data.heatingAge === '5 à 15 ans' ? 1.05 : 1.0;

  let consumptionTotalKwh = 0;
  if (data.noData) {
    consumptionTotalKwh = Math.round((refBase * yearRef.coef * sysCoef) * Number(data.surface || 0));
  } else {
    if (data.consumptionMode === 'euro') {
      const elecEuro = Number(data.elecEuro || 0);
      const gasEuro = Number(data.gasEuro || 0);
      const elecKwhFromEuro = elecEuro / 0.25;
      const gasKwhFromEuro = gasEuro / 0.12;
      consumptionTotalKwh = elecKwhFromEuro + gasKwhFromEuro;
    } else {
      const elec = Number(data.elecKwh || 0);
      const gas = Number(data.gasKwh || 0);
      consumptionTotalKwh = elec + gas;
    }

    if (!consumptionTotalKwh || consumptionTotalKwh <= 0) {
      consumptionTotalKwh = Math.round((refBase * yearRef.coef * sysCoef) * Number(data.surface || 0));
    }
  }

  const surface = Math.max(1, Number(data.surface || 1));
  const kwhPerM2 = Math.round(consumptionTotalKwh / surface);

  const dpe = typeof getDPE === 'function' ? getDPE(kwhPerM2) : { l: 'D', c: '#F59E0B', w: '70%' };

  const refTotal = refBase * surface;
  const diffPctRaw = ((kwhPerM2 - refBase) / refBase) * 100;
  const diffPct = Math.round(diffPctRaw);

  const totalCost = Math.round(consumptionTotalKwh * avgPrice);
  const wasteKwh = Math.max(0, consumptionTotalKwh - refTotal);
  const wasteEuro = Math.round(wasteKwh * avgPrice);

  const isDecretEligible = surface >= 1000;

  // Priorités - NE PAS FORMATER LES COÛTS ICI (on le fera dans le PDF)
  const potentialPriorities = [
    { id: 'roof', tag: 'Enveloppe', title: "Isolation toiture / combles", gainPct: 0.18, costMin: 6000, costMax: 25000 },
    { id: 'regulation', tag: 'Pilotage', title: "Régulation / programmation", gainPct: 0.10, costMin: 1500, costMax: 8000 },
    { id: 'windows', tag: 'Confort', title: "Menuiseries / étanchéité", gainPct: 0.08, costMin: 5000, costMax: 30000 },
    { id: 'heating', tag: 'Performance', title: "Remplacement chauffage", gainPct: 0.20, costMin: 12000, costMax: 30000 },
    { id: 'led', tag: 'ROI rapide', title: "Relamping LED complet", gainPct: 0.12, costMin: 3000, costMax: 12000 }
  ];

  let selectedIds = [];
  if (data.year === 'pre1975' || data.year === '1975-1990') {
    selectedIds = ['roof', 'regulation', 'windows'];
  } else {
    selectedIds = ['regulation', 'led', 'roof'];
  }

  if (data.heatingAge === '> 15 ans') {
    selectedIds[2] = 'heating';
  }

  const doneWorks = Array.isArray(data.works) ? data.works : [];
  const priorities = selectedIds
    .filter(id => !doneWorks.includes(id))
    .slice(0, 3)
    .map((id) => {
      const p = potentialPriorities.find(x => x.id === id);
      if (!p) return null;

      const gainKwhVal = Math.round(consumptionTotalKwh * p.gainPct);
      const gainEuro = Math.round(gainKwhVal * avgPrice);

      const aids = estimateAidRanges(p.id, surface, isDecretEligible);

      return {
        ...p,
        gainKwhVal,        // NOMBRE PUR (pas de formatage)
        gainKwhPct: `${Math.round(p.gainPct * 100)}%`,
        gainEuro,          // NOMBRE PUR (pas de formatage)
        aids
      };
    })
    .filter(Boolean);

  const annualSavingsIfTop3 = priorities.reduce((sum, p) => sum + p.gainEuro, 0);
  const projection5Y = annualSavingsIfTop3 * 5;
  const projection10Y = annualSavingsIfTop3 * 10;

  const timeline = [
    { step: 1, title: "Audit / visite technique", desc: "Valider les postes prioritaires et les hypothèses de consommation." },
    { step: 2, title: "Chiffrage et aides", desc: "Confirmer les devis et l'éligibilité réelle aux aides." },
    { step: 3, title: "Planification travaux", desc: "Prioriser les actions selon budget, usage et contraintes d'exploitation." },
    { step: 4, title: isDecretEligible ? "Suivi conformité Décret Tertiaire" : "Suivi des gains", desc: isDecretEligible ? "Structurer la trajectoire 2030/2040/2050." : "Vérifier les économies après travaux." }
  ];

  return {
    activityRef,
    yearRef,
    heatingLabel,
    occupationLabel,
    surface,
    refBase,
    refTotal,
    consumptionTotalKwh,
    kwhPerM2,
    dpe,
    avgPrice,
    totalCost,
    diffPct,
    diffPctRaw,
    wasteKwh,
    wasteEuro,
    isDecretEligible,
    priorities,
    annualSavingsIfTop3,
    projection5Y,
    projection10Y,
    timeline,
    disclaimer: {
      precision: "Ordre de grandeur (±30%)",
      legalShort: "Estimation directionnelle basée sur données déclaratives et références sectorielles. Non contractuel."
    }
  };
};

 const StepReport = ({ data }) => {
  const [rechartsReady, setRechartsReady] = useState(false);

  // ===== SOURCE UNIQUE DE DONNEES RAPPORT =====
  const report = buildReportData(data);

  const {
    activityRef,
    yearRef,
    heatingLabel,
    occupationLabel,
    surface,
    refBase,
    refTotal,
    consumptionTotalKwh,
    kwhPerM2,
    dpe,
    avgPrice,
    totalCost,
    diffPct,
    wasteKwh,
    wasteEuro,
    isDecretEligible,
    priorities,
    annualSavingsIfTop3,
    projection5Y,
    projection10Y,
    timeline,
    disclaimer
  } = report;

  // ===== CHARGEMENT RECHARTS =====
  useEffect(() => {
    const checkRecharts = () => {
      if (window.Recharts && window.Recharts.BarChart) setRechartsReady(true);
      else setTimeout(checkRecharts, 100);
    };
    checkRecharts();
  }, []);

  // ===== FORMATTERS LOCAUX =====
  const euro = (v) => `${Math.round(Number(v || 0)).toLocaleString('fr-FR')} €`;
  const intFmt = (v) => Math.round(Number(v || 0)).toLocaleString('fr-FR');

  const targetVal = isDecretEligible ? Math.round(refBase * 0.6) : Math.round(refBase * 0.8);

  const chartData = [
    { name: 'Votre bâtiment', val: kwhPerM2, fill: '#1E3A5F' },
    { name: `Référence ${activityRef?.label || 'secteur'}`, val: refBase, fill: '#95A5A6' },
    { name: isDecretEligible ? 'Objectif 2030' : 'Objectif perf.', val: targetVal, fill: '#2ECC71' },
  ];

  const handleExportPDF = (e) => {
    e.preventDefault();
    exportPDF(data, report);
  };

  // ===== INTERPRETATION RAPIDE (DYNAMIQUE) =====
  const getPerformanceMessage = () => {
    if (diffPct <= -10) {
      return {
        tone: 'good',
        title: 'Performance plutôt favorable',
        line1: `Votre bâtiment est environ ${Math.abs(diffPct)}% en dessous de la référence sectorielle, ce qui est plutôt bon.`,
        line2: `Le potentiel principal se situe souvent dans l'optimisation fine (pilotage, réglages, maintenance, usages).`,
        line3: `Prochaine étape recommandée : confirmer les gains rapides avant d'engager des travaux lourds.`
      };
    }
    if (diffPct > -10 && diffPct <= 15) {
      return {
        tone: 'mid',
        title: 'Performance dans la moyenne',
        line1: `Votre bâtiment est proche de la référence sectorielle (${diffPct > 0 ? '+' : ''}${diffPct}%).`,
        line2: `Il y a généralement un potentiel d'économie intéressant avec des actions ciblées et bien priorisées.`,
        line3: `Prochaine étape recommandée : valider les hypothèses avec vos factures et un chiffrage rapide.`
      };
    }
    return {
      tone: 'alert',
      title: 'Performance à améliorer en priorité',
      line1: `Votre bâtiment est au-dessus de la référence sectorielle (${diffPct > 0 ? '+' : ''}${diffPct}%).`,
      line2: `Cela suggère un surcoût potentiel significatif et justifie une priorisation des actions à ROI rapide.`,
      line3: `Prochaine étape recommandée : audit ciblé ou visite technique pour confirmer les postes les plus rentables.`
    };
  };

  const perfMsg = getPerformanceMessage();

  const perfStyles = {
    good: {
      box: 'bg-emerald-50 border-emerald-200',
      title: 'text-emerald-900',
      text: 'text-emerald-800',
      iconBg: 'bg-emerald-100',
      icon: 'text-emerald-600'
    },
    mid: {
      box: 'bg-blue-50 border-blue-200',
      title: 'text-blue-900',
      text: 'text-blue-800',
      iconBg: 'bg-blue-100',
      icon: 'text-blue-600'
    },
    alert: {
      box: 'bg-amber-50 border-amber-200',
      title: 'text-amber-900',
      text: 'text-amber-800',
      iconBg: 'bg-amber-100',
      icon: 'text-amber-600'
    }
  }[perfMsg.tone];

  // ===== PROJECTIONS =====
  const statusQuo5Y = totalCost * 5;
  const statusQuo10Y = totalCost * 10;
  const optimized5Y = Math.max(0, statusQuo5Y - projection5Y);
  const optimized10Y = Math.max(0, statusQuo10Y - projection10Y);

  // ===== PETIT HELPER POUR KPI CARD =====
  const KpiCard = ({ icon, label, value, sub, accent = 'text-[#1E3A5F]', iconBg = 'bg-slate-100' }) => (
    <div className="bg-white rounded-xl border border-slate-200 p-4 shadow-sm">
      <div className="flex items-start justify-between gap-3">
        <div className={`w-10 h-10 rounded-lg ${iconBg} flex items-center justify-center`}>
          <Icon icon={icon} className="text-lg" />
        </div>
        <span className="text-[11px] text-slate-400 italic">ordre de grandeur</span>
      </div>
      <p className="text-xs text-slate-500 mt-3">{label}</p>
      <p className={`text-xl tracking-tight font-semibold mt-1 ${accent}`}>{value}</p>
      {sub && <p className="text-xs text-slate-400 mt-1">{sub}</p>}
    </div>
  );

  return (
    <div className="fade-in pb-20 max-w-5xl mx-auto w-full">
      {/* ===== A. HERO / SYNTHÈSE ===== */}
      <div className="mb-6 bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden">
        <div className="bg-[#1E3A5F] p-5 md:p-6 text-white">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <div className="inline-flex items-center gap-2 bg-white/10 border border-white/20 rounded-full px-3 py-1 text-xs font-semibold mb-3">
                <Icon icon="solar:shield-check-linear" className="text-sm" />
                Estimation indicative
              </div>
              <h1 className="text-2xl md:text-3xl tracking-tight font-semibold">
                Votre pré-diagnostic énergétique tertiaire
              </h1>
              <p className="text-blue-100 text-sm mt-2">
                Estimation directionnelle pour aider à prioriser les prochaines décisions
              </p>
            </div>

            <div className="flex flex-col sm:flex-row gap-2">
              <button
                type="button"
                onClick={handleExportPDF}
                className="bg-white text-[#1E3A5F] px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-100 transition-colors flex items-center justify-center gap-2"
              >
                <Icon icon="solar:file-download-linear" className="text-base" />
                Exporter PDF
              </button>

              <a
                href={CTA_CALENDLY_URL}
                target="_blank"
                rel="noopener noreferrer"
                className="bg-[#2ECC71] text-white px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-[#27AE60] transition-colors flex items-center justify-center gap-2"
              >
                <Icon icon="solar:calendar-linear" className="text-base" />
                Prendre rendez-vous
              </a>
            </div>
          </div>
        </div>

        <div className="px-5 py-4 border-t border-slate-100 bg-slate-50 text-xs text-slate-500 flex flex-wrap items-center gap-4">
          <span className="inline-flex items-center gap-1">
            <Icon icon="solar:calendar-mark-linear" className="text-sm" />
            Généré le {new Date().toLocaleDateString('fr-FR')}
          </span>
          <span className="inline-flex items-center gap-1">
            <Icon icon="solar:info-circle-linear" className="text-sm" />
            {disclaimer?.precision || 'Ordre de grandeur (±30%)'}
          </span>
        </div>
      </div>

      {/* ===== B. KPI CARDS ===== */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <KpiCard
          icon="solar:bolt-linear"
          label="Consommation estimée"
          value={`${intFmt(kwhPerM2)} kWh/m²/an`}
          sub={`${intFmt(consumptionTotalKwh)} kWh/an au total`}
          iconBg="bg-blue-50"
          accent="text-[#1E3A5F]"
        />
        <KpiCard
          icon="solar:wallet-money-linear"
          label="Coût énergétique annuel"
          value={euro(totalCost)}
          sub={`Base prix énergie: ${avgPrice?.toFixed(2)?.replace('.', ',') || '0,00'} €/kWh`}
          iconBg="bg-emerald-50"
          accent="text-emerald-700"
        />
        <KpiCard
          icon="solar:chart-square-linear"
          label="Classe énergétique estimée"
          value={dpe?.l || 'N/A'}
          sub={`${intFmt(refBase)} kWh/m²/an de référence`}
          iconBg="bg-amber-50"
          accent="text-amber-700"
        />
        <KpiCard
          icon="solar:piggy-bank-linear"
          label="Potentiel d'économie annuel"
          value={euro(annualSavingsIfTop3)}
          sub={`Top 3 actions prioritaires`}
          iconBg="bg-purple-50"
          accent="text-purple-700"
        />
      </div>

      {/* ===== JAUGE DPE + COMPARAISON ===== */}
      <div className="grid lg:grid-cols-2 gap-6 mb-8">
        <SectionCard>
          <h2 className="text-lg tracking-tight font-semibold text-[#1E3A5F] mb-4">
            Positionnement énergétique estimé
          </h2>

          <div className="flex flex-col gap-1 mb-4 relative">
            {['A','B','C','D','E','F','G'].map((l, i) => {
              const info = getDPE(
                i === 0 ? 0 :
                i === 1 ? 71 :
                i === 2 ? 111 :
                i === 3 ? 181 :
                i === 4 ? 251 :
                i === 5 ? 331 : 421
              );

              return (
                <div
                  key={l}
                  className="relative h-8 flex items-center rounded-r-md transition-all"
                  style={{ width: info.w, backgroundColor: info.c }}
                >
                  <div className="w-8 flex justify-center font-semibold text-white pl-2 drop-shadow-md">{l}</div>

                  {dpe?.l === l && (
                    <div className="hidden md:flex absolute top-0 right-0 h-full items-center translate-x-full pl-2 z-10">
                      <div className="w-0 h-0 border-y-[6px] border-y-transparent border-r-[8px] border-r-[#1E3A5F] mr-2 rotate-180"></div>
                      <span className="text-base tracking-tight font-semibold text-[#1E3A5F] whitespace-nowrap">
                        {intFmt(kwhPerM2)} kWh/m²/an
                      </span>
                    </div>
                  )}
                </div>
              );
            })}
          </div>

          <p className="text-xs text-slate-500">
            Lecture simplifiée pour tertiaire. La classe est indicative et doit être confirmée par un audit si décision de travaux.
          </p>
        </SectionCard>

        <SectionCard>
          <h2 className="text-lg tracking-tight font-semibold text-[#1E3A5F] mb-1">
            Consommation vs référence
          </h2>
          <p className="text-xs text-slate-400 italic mb-4">
            Valeurs indicatives basées sur des moyennes sectorielles
          </p>

          <ChartErrorBoundary fallbackData={chartData}>
            <div className="h-64 w-full">
              {rechartsReady ? (
                <ResponsiveContainer width="100%" height="100%">
                  <BarChart layout="vertical" data={chartData} margin={{ top: 0, right: 70, left: 0, bottom: 0 }}>
                    <XAxis type="number" hide />
                    <YAxis
                      dataKey="name"
                      type="category"
                      width={150}
                      tick={{ fontSize: 12, fill: '#374151', fontWeight: 500 }}
                    />
                    <Tooltip cursor={{ fill: 'transparent' }} />
                    <Bar dataKey="val" radius={[0, 4, 4, 0]} barSize={24}>
                      {chartData.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.fill} />
                      ))}
                      <LabelList
                        dataKey="val"
                        position="right"
                        fill="#374151"
                        fontSize={12}
                        fontWeight="600"
                        formatter={(val) => `${val} kWh/m²`}
                      />
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              ) : (
                <div className="h-full flex items-center justify-center text-slate-400">Chargement...</div>
              )}
            </div>
          </ChartErrorBoundary>
        </SectionCard>
      </div>

      {/* ===== C. LECTURE RAPIDE ===== */}
      <div className={`mb-8 rounded-xl border p-5 ${perfStyles.box}`}>
        <div className="flex items-start gap-3">
          <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${perfStyles.iconBg}`}>
            <Icon icon="solar:notes-linear" className={`text-lg ${perfStyles.icon}`} />
          </div>
          <div className="flex-1">
            <h3 className={`text-sm font-semibold mb-2 ${perfStyles.title}`}>{perfMsg.title}</h3>
            <div className={`text-sm leading-relaxed space-y-1 ${perfStyles.text}`}>
              <p>{perfMsg.line1}</p>
              <p>{perfMsg.line2}</p>
              <p>{perfMsg.line3}</p>
            </div>
          </div>
        </div>
      </div>

      {/* ===== D. PROFIL BATIMENT ===== */}
      <SectionCard className="mb-8">
        <h2 className="text-lg tracking-tight font-semibold text-[#1E3A5F] mb-4">Profil du bâtiment</h2>

        <div className="grid md:grid-cols-2 gap-3">
          {[
            { label: 'Activité', value: activityRef?.label || 'Non renseigné', icon: 'solar:buildings-2-linear' },
            { label: 'Surface', value: `${intFmt(surface)} m²`, icon: 'solar:ruler-cross-pen-linear' },
            { label: 'Période de construction', value: yearRef?.label || 'Non renseigné', icon: 'solar:calendar-linear' },
            { label: 'Chauffage principal', value: heatingLabel || 'Non renseigné', icon: 'solar:flame-linear' },
            { label: 'Occupation', value: occupationLabel || 'Non renseigné', icon: 'solar:users-group-rounded-linear' },
            {
              label: 'Mode de donnée',
              value: data?.noData ? 'Estimation automatique' : (data?.consumptionMode === 'euro' ? 'Factures en €' : 'Consommations en kWh'),
              icon: 'solar:database-linear'
            },
          ].map((row, i) => (
            <div key={i} className="bg-slate-50 border border-slate-200 rounded-lg p-3 flex items-start gap-3">
              <div className="w-8 h-8 rounded-md bg-white border border-slate-200 flex items-center justify-center">
                <Icon icon={row.icon} className="text-sm" />
              </div>
              <div>
                <p className="text-xs text-slate-500">{row.label}</p>
                <p className="text-sm font-semibold text-slate-800">{row.value}</p>
              </div>
            </div>
          ))}
        </div>

        <div className="mt-4 grid md:grid-cols-3 gap-3">
          <div className="border border-slate-200 rounded-lg p-3">
            <p className="text-xs text-slate-500">Référence sectorielle</p>
            <p className="text-sm font-semibold text-[#1E3A5F]">{intFmt(refBase)} kWh/m²/an</p>
          </div>
          <div className="border border-slate-200 rounded-lg p-3">
            <p className="text-xs text-slate-500">Écart estimé</p>
            <p className={`text-sm font-semibold ${diffPct > 0 ? 'text-amber-700' : 'text-emerald-700'}`}>
              {diffPct > 0 ? '+' : ''}{diffPct}% vs référence
            </p>
          </div>
          <div className="border border-slate-200 rounded-lg p-3">
            <p className="text-xs text-slate-500">Surcoût potentiel</p>
            <p className="text-sm font-semibold text-slate-800">{euro(wasteEuro)}</p>
          </div>
        </div>
      </SectionCard>

      {/* ===== E. ACTIONS PRIORITAIRES ===== */}
      <div className="mb-8">
        <h2 className="text-xl tracking-tight font-semibold text-[#1E3A5F] mb-2">Actions prioritaires</h2>
        <p className="text-sm text-slate-500 mb-4">
          Priorisation indicative à confirmer par visite technique et devis
        </p>

        {priorities.length === 0 ? (
          <div className="bg-white rounded-xl border border-slate-200 p-4 text-sm text-slate-600">
            Vous avez déjà réalisé plusieurs actions pertinentes. Les gains restants se situent souvent dans les réglages,
            la maintenance, le pilotage et l'ajustement des usages.
          </div>
        ) : (
          <div className="space-y-4">
            {priorities.map((p, i) => {
              const roiMin = p.gainEuro > 0 ? (p.costMin / p.gainEuro) : null;
              const roiMax = p.gainEuro > 0 ? (p.costMax / p.gainEuro) : null;

              const avgCost = (p.costMin + p.costMax) / 2;
              const effort =
                avgCost < 7000 ? 'Faible' :
                avgCost < 18000 ? 'Moyen' : 'Élevé';

              const effortStyle =
                effort === 'Faible' ? 'bg-emerald-100 text-emerald-700' :
                effort === 'Moyen' ? 'bg-amber-100 text-amber-700' :
                'bg-rose-100 text-rose-700';

              return (
                <div key={i} className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                  <div className="px-4 py-3 bg-slate-50 border-b border-slate-100 flex flex-col md:flex-row md:items-center md:justify-between gap-2">
                    <div className="flex items-center gap-2">
                      <span className="text-xs font-semibold text-slate-400">PRIORITÉ #{i + 1}</span>
                      <span className="text-xs font-semibold px-2 py-1 rounded bg-white border border-slate-200 text-[#1E3A5F]">
                        {p.tag}
                      </span>
                    </div>
                    <span className={`text-xs font-semibold px-2 py-1 rounded ${effortStyle}`}>
                      Effort {effort}
                    </span>
                  </div>

                  <div className="p-4">
                    <h3 className="text-base md:text-lg font-semibold text-[#1E3A5F] mb-4">{p.title}</h3>

                    <div className="grid sm:grid-cols-2 lg:grid-cols-5 gap-3">
                      <div className="border border-slate-200 rounded-lg p-3">
                        <p className="text-[11px] text-slate-500">Gain énergie</p>
                        <p className="text-sm font-semibold text-slate-800">{intFmt(p.gainKwhVal)} kWh/an</p>
                      </div>

                      <div className="border border-slate-200 rounded-lg p-3">
                        <p className="text-[11px] text-slate-500">Gain financier</p>
                        <p className="text-sm font-semibold text-emerald-700">{euro(p.gainEuro)}/an</p>
                      </div>

                      <div className="border border-slate-200 rounded-lg p-3">
                        <p className="text-[11px] text-slate-500">Coût estimatif</p>
                        <p className="text-sm font-semibold text-slate-800">
                          {intFmt(p.costMin)} à {intFmt(p.costMax)} €
                        </p>
                      </div>

                      <div className="border border-slate-200 rounded-lg p-3">
                        <p className="text-[11px] text-slate-500">ROI estimatif</p>
                        <p className="text-sm font-semibold text-[#1E3A5F]">
                          {roiMin && roiMax
                            ? `${roiMin.toFixed(1).replace('.', ',')} à ${roiMax.toFixed(1).replace('.', ',')} ans`
                            : 'À estimer'}
                        </p>
                      </div>

                      <div className="border border-slate-200 rounded-lg p-3">
                        <p className="text-[11px] text-slate-500">Aides</p>
                        <p className="text-sm font-semibold text-slate-800">
                          {(p.aids?.cee || p.aids?.mpr) ? 'Possibles' : 'À vérifier'}
                        </p>
                      </div>
                    </div>

                    <div className="mt-3 rounded-lg bg-amber-50 border border-amber-200 p-3">
                      <p className="text-xs font-semibold text-amber-900 mb-1">Aides indicatives (à confirmer)</p>
                      <div className="space-y-1">
                        {p.aids?.cee?.label && <p className="text-xs text-amber-800">• {p.aids.cee.label}</p>}
                        {p.aids?.mpr?.label && <p className="text-xs text-amber-800">• {p.aids.mpr.label}</p>}
                        {p.aids?.decret?.label && <p className="text-xs text-amber-800">• {p.aids.decret.label}</p>}
                        {!p.aids?.cee?.label && !p.aids?.mpr?.label && !p.aids?.decret?.label && (
                          <p className="text-xs text-amber-800">• Éligibilité à vérifier selon votre situation</p>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* ===== F. PROJECTIONS 5 ANS / 10 ANS ===== */}
      <div className="mb-8">
        <h2 className="text-xl tracking-tight font-semibold text-[#1E3A5F] mb-2">Projection financière</h2>
        <p className="text-sm text-slate-500 mb-4">
          Simulation simple à partir des économies annuelles estimées (hors inflation et évolution des prix énergie)
        </p>

        <div className="grid md:grid-cols-2 gap-4">
          <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-5">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-base font-semibold text-[#1E3A5F]">Projection à 5 ans</h3>
              <span className="text-xs font-semibold px-2 py-1 rounded bg-slate-100 text-slate-600">5 ans</span>
            </div>

            <div className="space-y-2 text-sm">
              <div className="flex justify-between gap-3">
                <span className="text-slate-500">Statu quo (sans optimisation)</span>
                <span className="font-semibold text-slate-800">{euro(statusQuo5Y)}</span>
              </div>
              <div className="flex justify-between gap-3">
                <span className="text-slate-500">Avec optimisations (estim.)</span>
                <span className="font-semibold text-slate-800">{euro(optimized5Y)}</span>
              </div>
              <div className="pt-2 mt-2 border-t border-slate-100 flex justify-between gap-3">
                <span className="text-slate-700 font-medium">Économie potentielle cumulée</span>
                <span className="font-semibold text-emerald-700">{euro(projection5Y)}</span>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-5">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-base font-semibold text-[#1E3A5F]">Projection à 10 ans</h3>
              <span className="text-xs font-semibold px-2 py-1 rounded bg-slate-100 text-slate-600">10 ans</span>
            </div>

            <div className="space-y-2 text-sm">
              <div className="flex justify-between gap-3">
                <span className="text-slate-500">Statu quo (sans optimisation)</span>
                <span className="font-semibold text-slate-800">{euro(statusQuo10Y)}</span>
              </div>
              <div className="flex justify-between gap-3">
                <span className="text-slate-500">Avec optimisations (estim.)</span>
                <span className="font-semibold text-slate-800">{euro(optimized10Y)}</span>
              </div>
              <div className="pt-2 mt-2 border-t border-slate-100 flex justify-between gap-3">
                <span className="text-slate-700 font-medium">Économie potentielle cumulée</span>
                <span className="font-semibold text-emerald-700">{euro(projection10Y)}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ===== G. TIMELINE 3 MOIS ===== */}
      <SectionCard className="mb-8">
        <h2 className="text-xl tracking-tight font-semibold text-[#1E3A5F] mb-2">Plan d'action sur 3 mois</h2>
        <p className="text-sm text-slate-500 mb-5">
          Objectif : passer d'une estimation à une décision chiffrée
        </p>

        <div className="space-y-4">
          {(timeline || []).map((t, i) => {
            const periodLabel =
              i === 0 ? 'Semaine 1 à 2' :
              i === 1 ? 'Semaine 2 à 4' :
              i === 2 ? 'Mois 2' : 'Mois 2 à 3';

            return (
              <div key={i} className="flex items-start gap-3">
                <div className="flex flex-col items-center">
                  <div className="w-9 h-9 rounded-full bg-[#EEF2FF] border border-[#1E3A5F]/20 flex items-center justify-center text-[#1E3A5F] font-semibold text-sm">
                    {t.step}
                  </div>
                  {i < (timeline.length - 1) && <div className="w-px h-10 bg-slate-200 mt-2"></div>}
                </div>

                <div className="flex-1 bg-slate-50 border border-slate-200 rounded-lg p-3">
                  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-1">
                    <p className="text-sm font-semibold text-slate-800">{t.title}</p>
                    <span className="text-xs text-slate-500">{periodLabel}</span>
                  </div>
                  <p className="text-sm text-slate-600 mt-1">{t.desc}</p>
                </div>
              </div>
            );
          })}
        </div>
      </SectionCard>

      {/* ===== H. HYPOTHESES & LIMITES ===== */}
      <div className="mb-8 bg-amber-50 border border-amber-200 rounded-xl p-4">
        <div className="flex items-start gap-3">
          <div className="w-9 h-9 rounded-lg bg-amber-100 flex items-center justify-center">
            <Icon icon="solar:danger-triangle-linear" className="text-amber-600 text-base" />
          </div>
          <div>
            <h3 className="text-sm font-semibold text-amber-900 mb-2">Hypothèses et limites</h3>
            <ul className="text-sm text-amber-800 space-y-1">
              <li>• Rapport indicatif basé sur des données déclaratives et des références sectorielles.</li>
              <li>• Ne remplace pas un audit réglementaire ou un audit d'exécution.</li>
              <li>• Prix énergie, aides et devis peuvent varier selon votre situation réelle.</li>
              <li>• Validation terrain recommandée avant engagement de travaux.</li>
              {isDecretEligible && <li>• Votre surface suggère un sujet potentiel Décret Tertiaire à vérifier.</li>}
            </ul>
          </div>
        </div>
      </div>

      {/* ===== I. CTA FINAL SOBRE ===== */}
      <div className="bg-[#1E3A5F] rounded-2xl p-6 md:p-8 shadow-xl text-white">
        <div className="grid md:grid-cols-2 gap-6 items-center">
          <div>
            <h3 className="text-xl tracking-tight font-semibold mb-2">
              Besoin d'un cadrage plus fiable pour passer à l'action ?
            </h3>
            <p className="text-sm text-blue-100 leading-relaxed">
              Ce pré-diagnostic est utile pour prioriser. La suite logique est de valider les hypothèses, chiffrer correctement
              les postes et sécuriser les aides mobilisables.
            </p>

            <div className="mt-4 flex flex-wrap gap-2 text-xs">
              <span className="px-2 py-1 rounded bg-white/10 border border-white/10">Validation des priorités</span>
              <span className="px-2 py-1 rounded bg-white/10 border border-white/10">Aides et ROI</span>
              <span className="px-2 py-1 rounded bg-white/10 border border-white/10">Plan d'action concret</span>
            </div>
          </div>

          <div className="space-y-3">
            <button
              type="button"
              onClick={handleExportPDF}
              className="w-full bg-white text-[#1E3A5F] py-3 rounded-lg font-semibold hover:bg-slate-100 transition-colors flex items-center justify-center gap-2"
            >
              <Icon icon="solar:file-download-linear" className="text-base" />
              Télécharger le rapport PDF
            </button>

            <a
              href={CTA_CALENDLY_URL}
              target="_blank"
              rel="noopener noreferrer"
              className="w-full bg-[#2ECC71] text-white py-3 rounded-lg font-semibold hover:bg-[#27AE60] transition-colors flex items-center justify-center gap-2"
            >
              <Icon icon="solar:calendar-linear" className="text-base" />
              Réserver un échange
            </a>
          </div>
        </div>
      </div>
    </div>
  );
};
      /* --- PAGES --- */
      const PageHome = ({ navigate }) => (
          <div className="fade-in">
              {/* SECTION 1 - HERO */}
              <section className="bg-gradient-to-b from-[#F8F9FA] to-white py-16 lg:py-24">
                  <div className="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-12 items-center">
                      <div>
                          <div className="inline-flex items-center gap-2 bg-[#2ECC71]/10 border border-[#2ECC71]/30 rounded-full px-4 py-1.5 text-sm font-semibold text-[#2ECC71] mb-6">
                              <Icon icon="solar:clock-circle-bold" className="text-base" />
                              Gratuit • 3 minutes • Résultat immédiat
                          </div>
                          <h1 className="text-4xl lg:text-5xl tracking-tight font-semibold text-slate-900 leading-[1.1] mb-6">
                              Votre bâtiment tertiaire vous coûte-t-il trop cher en énergie ? 
                          </h1>
                          <p className="text-lg text-[#6B7280] leading-relaxed mb-8">
                              Le premier diagnostic gratuit conçu pour les bâtiments tertiaires. Comparez-vous aux bonnes références sectorielles, pas au logement.
                          </p>

                          <div className="grid sm:grid-cols-2 gap-6 mb-8">
                              <div className="space-y-3">
                                  <p className="text-sm font-semibold text-[#1E3A5F] uppercase tracking-wide">Propriétaires</p>
                                  {['Évaluez la performance de votre patrimoine','Identifiez les postes les plus coûteux','Estimez le ROI de vos travaux'].map((t, i) => (
                                      <div key={i} className="flex items-start gap-2">
                                          <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'18px', flexShrink:0, marginTop:'2px'}}></iconify-icon>
                                          <span className="text-sm text-slate-600">{t}</span>
                                      </div>
                                  ))}
                              </div>
                              <div className="space-y-3">
                                  <p className="text-sm font-semibold text-[#1E3A5F] uppercase tracking-wide">Locataires</p>
                                  {['Objectivez vos demandes de rénovation','Négociez avec des chiffres concrets','Anticipez vos futures factures'].map((t, i) => (
                                      <div key={i} className="flex items-start gap-2">
                                          <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'18px', flexShrink:0, marginTop:'2px'}}></iconify-icon>
                                          <span className="text-sm text-slate-600">{t}</span>
                                      </div>
                                  ))}
                              </div>
                          </div>

                          <button type="button" onClick={() => navigate('diagnostic')} className="bg-[#1E3A5F] text-white px-8 py-4 rounded-xl text-base font-semibold hover:bg-[#162B47] shadow-lg transition-all flex items-center gap-2">
                              Obtenir mon diagnostic gratuit (3 min) <Icon icon="solar:arrow-right-linear" className="text-base" />
                          </button>
                          <div className="flex items-center gap-4 text-xs text-slate-500 mt-4">
                              <span className="flex items-center gap-1"><iconify-icon icon="solar:check-read-linear" style={{fontSize:'14px', color:'#2ECC71'}}></iconify-icon> Aucune expertise requise</span>
                              <span className="flex items-center gap-1"><iconify-icon icon="solar:check-read-linear" style={{fontSize:'14px', color:'#2ECC71'}}></iconify-icon> Résultat immédiat</span>
                              <span className="flex items-center gap-1"><iconify-icon icon="solar:check-read-linear" style={{fontSize:'14px', color:'#2ECC71'}}></iconify-icon> Aucun engagement</span>
                          </div>
                      </div>

                      <div className="hidden md:block">
                          <div className="bg-white rounded-2xl shadow-2xl p-6 border border-slate-100 relative">
                              <div className="flex items-center gap-3 mb-4">
                                  <div className="w-16 h-16 rounded-xl flex items-center justify-center text-3xl font-semibold" style={{backgroundColor:'#FFCC00'}}>
                                      <span style={{color:'#1E3A5F'}}>D</span>
                                  </div>
                                  <div>
                                      <div className="text-sm font-semibold text-slate-900">Classe estimée : D</div>
                                      <div className="text-xs text-slate-400">245 kWh/m²/an</div>
                                  </div>
                              </div>
                              <div className="space-y-2 mb-4">
                                  {[{l:'Isolation toiture', c:'#F39C12', g:'2 100 €/an'},{l:'Régulation / GTB', c:'#0891B2', g:'1 500 €/an'}].map((p, i) => (
                                      <div key={i} className="bg-slate-50 rounded-lg p-3">
                                          <div className="flex items-center gap-2 mb-1">
                                              <div className="w-2 h-2 rounded-full" style={{backgroundColor:p.c}} />
                                              <span className="text-xs font-medium text-slate-700">{p.l}</span>
                                          </div>
                                          <span className="text-xs font-semibold text-[#2ECC71]">Économie : {p.g}</span>
                                      </div>
                                  ))}
                              </div>
                              <div className="absolute -top-3 -right-3 bg-[#2ECC71] text-white text-xs font-semibold px-3 py-1.5 rounded-full shadow-lg flex items-center gap-1">
                                  <iconify-icon icon="solar:bolt-linear" style={{fontSize:'14px'}}></iconify-icon> Rapport en 3 min
                              </div>
                          </div>
                      </div>
                  </div>
              </section>

              {/* SECTION 2 - SEGMENTATION PROFILS + PREUVES */}
<section className="bg-white py-10 border-y border-slate-100">
  <div className="max-w-6xl mx-auto px-4">
    <div className="grid lg:grid-cols-3 gap-4 mb-6">
      {[
        {
          title: "Je suis propriétaire",
          icon: "solar:buildings-2-linear",
          color: "#1E3A5F",
          desc: "Évaluez rapidement la performance de votre actif et identifiez les travaux prioritaires selon le ROI.",
          cta: "Lancer mon diagnostic",
          action: () => navigate('diagnostic')
        },
        {
          title: "Je suis locataire / exploitant",
          icon: "solar:briefcase-linear",
          color: "#F39C12",
          desc: "Objectivez vos surcoûts énergétiques et préparez une discussion chiffrée avec le propriétaire.",
          cta: "Voir un exemple de rapport",
          action: () => navigate('exemple')
        },
        {
          title: "Je suis un professionnel",
          icon: "solar:case-round-minimalistic-linear",
          color: "#2ECC71",
          desc: "Proposez un diagnostic de cadrage à vos clients (cabinet comptable, conseil, immobilier, courtage).",
          cta: "Découvrir l’espace pro",
          action: () => navigate('pro')
        }
      ].map((card, i) => (
        <div key={i} className="bg-slate-50 border border-slate-200 rounded-xl p-5 hover:border-slate-300 hover:shadow-sm transition-all">
          <div className="flex items-start gap-3 mb-3">
            <div
              className="w-11 h-11 rounded-xl flex items-center justify-center shrink-0"
              style={{ backgroundColor: `${card.color}15` }}
            >
              <iconify-icon icon={card.icon} style={{ fontSize: '22px', color: card.color }}></iconify-icon>
            </div>
            <div>
              <h3 className="text-sm font-semibold text-slate-900">{card.title}</h3>
              <p className="text-xs text-slate-600 mt-1 leading-relaxed">{card.desc}</p>
            </div>
          </div>

          <button
            type="button"
            onClick={card.action}
            className="w-full mt-2 bg-white border border-slate-300 text-slate-700 text-sm font-semibold py-2.5 rounded-lg hover:bg-slate-100 transition-colors"
          >
            {card.cta}
          </button>
        </div>
      ))}
    </div>

    <div className="grid md:grid-cols-3 gap-3">
      <div className="rounded-lg border border-slate-200 bg-white px-4 py-3 flex items-start gap-2">
        <iconify-icon icon="solar:target-linear" style={{ fontSize: '18px', color: '#1E3A5F', marginTop: '1px' }}></iconify-icon>
        <div>
          <p className="text-xs font-semibold text-slate-800">Références tertiaires</p>
          <p className="text-xs text-slate-500">Comparaison par activité, pas sur des standards résidentiels.</p>
        </div>
      </div>

      <div className="rounded-lg border border-slate-200 bg-white px-4 py-3 flex items-start gap-2">
        <iconify-icon icon="solar:shield-check-linear" style={{ fontSize: '18px', color: '#2ECC71', marginTop: '1px' }}></iconify-icon>
        <div>
          <p className="text-xs font-semibold text-slate-800">Estimation claire</p>
          <p className="text-xs text-slate-500">Ordre de grandeur utile pour décider si un audit complet est pertinent.</p>
        </div>
      </div>

      <div className="rounded-lg border border-slate-200 bg-white px-4 py-3 flex items-start gap-2">
        <iconify-icon icon="solar:document-text-linear" style={{ fontSize: '18px', color: '#F39C12', marginTop: '1px' }}></iconify-icon>
        <div>
          <p className="text-xs font-semibold text-slate-800">Rapport actionnable</p>
          <p className="text-xs text-slate-500">Priorités, gains, coûts, ROI indicatif et premières aides à vérifier.</p>
        </div>
      </div>
    </div>
  </div>
</section>

              {/* SECTION 3 - PROBLÈME */}
              <section className="bg-[#F8F9FA] py-16">
                  <div className="max-w-6xl mx-auto px-4">
                      <SectionTitle sub="Sans diagnostic, vous perdez de l'argent chaque jour">Le coût caché de l'inaction</SectionTitle>
                      <div className="grid md:grid-cols-3 gap-6">
                          {[
                              {icon:'solar:bill-list-linear', color:'#E74C3C', title:'Des factures qui explosent', desc:"En 3 ans, le prix de l'énergie a augmenté de 45% en moyenne. Sans diagnostic, impossible de savoir si vous payez 2 000 € ou 20 000 € de trop chaque année.", stat:'15 à 35% de surcoût énergétique sur les bâtiments non optimisés'},
                              {icon:'solar:hourglass-linear', color:'#F39C12', title:'Aucun outil adapté', desc:"Les simulateurs en ligne sont conçus pour le logement. Un commerce qui consomme 350 kWh/m²/an y serait classé G — alors que c'est normal. Résultat : impossible de savoir si vous êtes bon ou mauvais.", stat:"Les références résidentielles faussent l'analyse de 40 à 60%"},
                              {icon:'solar:wallet-linear', color:'#7B3F9E', title:'Des aides qui disparaissent', desc:"MaPrimeRénov', CEE, subventions ADEME : les enveloppes se vident. Les propriétaires qui attendent perdent jusqu'à 40% du budget travaux.", stat:'9 000 € en moyenne d\'aides non optimisées'},
                          ].map((c, i) => (
                              <div key={i} className="bg-white rounded-xl p-6 border border-slate-100 hover:shadow-lg transition-shadow">
                                  <div className="w-12 h-12 rounded-xl flex items-center justify-center mb-4" style={{backgroundColor:c.color+'15'}}>
                                      <iconify-icon icon={c.icon} style={{fontSize:'24px', color:c.color}}></iconify-icon>
                                  </div>
                                  <h3 className="text-base font-semibold text-slate-900 mb-3">{c.title}</h3>
                                  <p className="text-sm text-slate-600 leading-relaxed mb-4">{c.desc}</p>
                                  <div className="bg-slate-50 rounded-lg p-3 border-l-4" style={{borderColor:c.color}}>
                                      <p className="text-xs font-semibold text-slate-700">{c.stat}</p>
                                  </div>
                              </div>
                          ))}
                      </div>
                  </div>
              </section>

              {/* SECTION 4 - SOLUTION */}
              <section className="bg-white py-16">
                  <div className="max-w-6xl mx-auto px-4">
                      <SectionTitle sub="Enfin un outil adapté au tertiaire">Un diagnostic en 3 minutes qui change tout</SectionTitle>
                      <div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-10">
                          {[
                              {icon:'solar:clock-circle-linear', color:'#2ECC71', title:'3 minutes top chrono', desc:'Quelques clics suffisent. Pas de rendez-vous, pas de visite, pas de paperasse.'},
                              {icon:'solar:target-linear', color:'#0891B2', title:'Estimation sur-mesure', desc:'Algorithme basé sur 12 000+ bâtiments tertiaires. Prend en compte votre activité, surface, année.'},
                              {icon:'solar:calculator-linear', color:'#F39C12', title:'Chiffrage immédiat', desc:'Classe énergétique + 3 priorités avec coûts, gains et ROI. Vous savez exactement où vous en êtes.'},
                              {icon:'solar:shield-check-linear', color:'#1E3A5F', title:'100% gratuit et neutre', desc:"Aucun engagement. Aucune revente de données. Aucun démarchage commercial."},
                          ].map((b, i) => (
                              <div key={i} className="text-center">
                                  <div className="w-14 h-14 rounded-xl flex items-center justify-center mx-auto mb-3" style={{backgroundColor:b.color+'15'}}>
                                      <iconify-icon icon={b.icon} style={{fontSize:'28px', color:b.color}}></iconify-icon>
                                  </div>
                                  <h3 className="text-sm font-semibold text-slate-900 mb-2">{b.title}</h3>
                                  <p className="text-xs text-slate-600 leading-relaxed">{b.desc}</p>
                              </div>
                          ))}
                      </div>

                      <div className="bg-gradient-to-br from-[#EEF2FF] to-[#E0F2FE] rounded-2xl p-6 border border-[#1E3A5F]/20">
                          <div className="flex items-start gap-4">
                              <iconify-icon icon="solar:chat-round-line-linear" style={{fontSize:'32px', color:'#1E3A5F', flexShrink:0}} />
                              <div>
                                  <p className="text-sm text-slate-700 italic leading-relaxed mb-2">
                                      "Je pensais que mon hôtel était un gouffre énergétique. Les simulateurs classiques me mettaient en classe F. Avec DiagTertiaire, j'ai découvert que 280 kWh/m²/an, c'est la norme pour un hôtel. Ça m'a rassuré et permis de cibler les vrais problèmes : la régulation et l'ECS. J'ai économisé 3 200 €/an avec 5 000 € de travaux."
                                  </p>
                                  <p className="text-xs text-slate-500 font-medium">Sophie M., propriétaire hôtel 45 chambres</p>
                              </div>
                          </div>
                      </div>

                      <div className="text-center mt-8">
                          <button type="button" onClick={() => navigate('exemple')} className="text-sm text-[#1E3A5F] hover:underline font-medium">
                              → Voir un exemple de rapport complet
                          </button>
                      </div>
                  </div>
              </section>

              {/* SECTION 5 - COMMENT ÇA MARCHE */}
              <section className="bg-gradient-to-b from-[#F8F9FA] to-white py-16">
                  <div className="max-w-6xl mx-auto px-4">
                      <SectionTitle sub="Un processus simple et transparent">Comment ça marche ? Suivez le guide.</SectionTitle>
                      <div className="grid md:grid-cols-4 gap-8 relative">
                          {[
                              {n:'01', icon:'solar:buildings-2-linear', color:'#1E3A5F', time:'30 sec', title:'Votre bâtiment', items:['Activité (bureau/commerce/hôtel)','Surface et année de construction']},
                              {n:'02', icon:'solar:bolt-linear', color:'#2ECC71', time:'1 min', title:'Vos équipements', items:['Chauffage et consommation','Travaux déjà réalisés']},
                              {n:'03', icon:'solar:inbox-linear', color:'#F39C12', time:'15 sec', title:'Votre email', items:['Pour recevoir le rapport complet','Données protégées, jamais revendues']},
                              {n:'04', icon:'solar:document-text-linear', color:'#7B3F9E', time:'Instantané', title:'Votre diagnostic', items:['Classe énergétique estimée','3 priorités chiffrées','Aides mobilisables']},
                          ].map((s, i) => (
                              <div key={i} className="relative">
                                  {i < 3 && (
                                      <div className="hidden md:block absolute top-8 -right-4 z-0">
                                          <iconify-icon icon="solar:arrow-right-linear" style={{fontSize:'24px', color:'#CBD5E1'}}></iconify-icon>
                                      </div>
                                  )}
                                  <div className="relative z-10">
                                      <div className="text-5xl font-semibold text-slate-100 mb-3">{s.n}</div>
                                      <div className="w-12 h-12 rounded-xl flex items-center justify-center mb-3" style={{backgroundColor:s.color+'15'}}>
                                          <iconify-icon icon={s.icon} style={{fontSize:'24px', color:s.color}}></iconify-icon>
                                      </div>
                                      <div className="inline-block bg-white border border-slate-200 rounded-full px-3 py-1 text-xs font-semibold text-slate-600 mb-3">{s.time}</div>
                                      <h3 className="text-sm font-semibold text-slate-900 mb-2">{s.title}</h3>
                                      <ul className="space-y-1">
                                          {s.items.map((item, j) => (
                                              <li key={j} className="text-xs text-slate-600 flex items-start gap-1.5">
                                                  <iconify-icon icon="solar:arrow-right-linear" style={{fontSize:'14px', color:s.color, flexShrink:0, marginTop:'2px'}}></iconify-icon>
                                                  {item}
                                              </li>
                                          ))}
                                      </ul>
                                  </div>
                              </div>
                          ))}
                      </div>
                      <div className="text-center mt-10">
                          <button type="button" onClick={() => navigate('diagnostic')} className="bg-[#1E3A5F] text-white px-8 py-4 rounded-xl text-base font-semibold hover:bg-[#162B47] shadow-lg transition-all inline-flex items-center gap-2">
                              Lancer mon diagnostic (ça prend 3 min) <Icon icon="solar:arrow-right-linear" className="text-base" />
                          </button>
                      </div>
                  </div>
              </section>

              {/* SECTION 6 - CE QUE VOUS RECEVEZ */}
              <section className="bg-white py-16">
                  <div className="max-w-6xl mx-auto px-4">
                      <SectionTitle sub="Voici exactement ce que contient votre rapport gratuit">Ce que vous recevez</SectionTitle>
                      <div className="grid md:grid-cols-2 gap-6">
                          {[
                              {title:'Votre classe énergétique estimée', desc:'Jauge A à G avec votre position et comparaison vs référence sectorielle'},
                              {title:'Vos 3 actions prioritaires', desc:'Pour chaque action : gain annuel en €, coût des travaux, ROI en années, aides mobilisables'},
                              {title:"Votre plan d'action sur 3 mois", desc:'Étapes concrètes pour passer du diagnostic à la réalisation'},
                              {title:'Économies estimées sur 5 et 10 ans', desc:'Projection financière avec et sans travaux pour arbitrer vos investissements'},
                          ].map((r, i) => (
                              <div key={i} className="flex items-start gap-4 p-5 rounded-xl border border-slate-200 hover:border-[#1E3A5F]/30 hover:shadow-md transition-all">
                                  <div className="w-12 h-12 rounded-lg bg-[#1E3A5F]/10 flex items-center justify-center flex-shrink-0">
                                      <iconify-icon icon="solar:document-text-linear" style={{fontSize:'24px', color:'#1E3A5F'}}></iconify-icon>
                                  </div>
                                  <div>
                                      <h3 className="text-sm font-semibold text-slate-900 mb-1">{r.title}</h3>
                                      <p className="text-xs text-slate-600 leading-relaxed">{r.desc}</p>
                                  </div>
                              </div>
                          ))}
                      </div>

                      <div className="mt-8 bg-amber-50 border border-amber-200 rounded-xl p-5 flex items-start gap-3">
                          <iconify-icon icon="solar:lightbulb-linear" style={{fontSize:'24px', color:'#F39C12', flexShrink:0}} />
                          <div>
                              <p className="text-sm font-bold text-amber-900 mb-1">Sachez si ça vaut le coup</p>
                              <p className="text-xs text-amber-700">Avant d'investir 800 à 1 500 € dans un audit complet, notre diagnostic vous donne les clés pour décider en connaissance de cause.</p>
                          </div>
                      </div>

                      <div className="text-center mt-8">
                          <button type="button" onClick={() => navigate('diagnostic')} className="bg-[#1E3A5F] text-white px-8 py-4 rounded-xl text-base font-semibold hover:bg-[#162B47] shadow-lg transition-all inline-flex items-center gap-2">
                              Je veux mon rapport gratuit <Icon icon="solar:arrow-right-linear" className="text-base" />
                          </button>
                      </div>
                  </div>
              </section>

              {/* SECTION 7 - CAS D'USAGE */}
              <section className="bg-[#F8F9FA] py-16">
                  <div className="max-w-6xl mx-auto px-4">
                      <SectionTitle sub="Des propriétaires et locataires comme vous">Qui utilise DiagTertiaire ?</SectionTitle>

                      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
                          {[
                              {profile:'Petit propriétaire tertiaire', icon:'solar:buildings-linear', color:'#E74C3C', quote:'J\'ai un local commercial de 180m². Tous les simulateurs en ligne m\'orientaient vers du résidentiel. Résultat : des recommandations absurdes. Ici, en 3 min, j\'ai eu une estimation cohérente avec mon activité.', usage:'Absence d\'outil adapté'},
                              {profile:'Propriétaire exploitant', icon:'solar:user-linear', color:'#2ECC71', quote:'Je voulais savoir si mes factures étaient normales. En 3 min j\'ai su que mon bâtiment consommait 28% de plus que la référence. J\'ai lancé un audit complet et divisé ma facture par 2 en 18 mois.', usage:'Évaluation patrimoine'},
                              {profile:'Gestionnaire de parc', icon:'solar:case-round-minimalistic-linear', color:'#0891B2', quote:'Je gère 12 bâtiments. Impossible de tout auditer. Ce diagnostic m\'a permis d\'identifier les 3 pires consommateurs et de prioriser mes budgets.', usage:'Priorisation investissements'},
                              {profile:'Locataire bureau', icon:'solar:briefcase-linear', color:'#F39C12', quote:'Ma facture avait doublé en 2 ans. Grâce au rapport, j\'ai pu négocier avec mon propriétaire des travaux d\'isolation. Résultat : -40% sur ma facture.', usage:'Négociation bail vert'},
                              {profile:'Expert-comptable', icon:'solar:calculator-linear', color:'#7B3F9E', quote:'Je conseille 40 PME. Quand un client me montre ses factures énergie, je peux maintenant lui proposer ce diagnostic en 2 clics. Ça positionne mon cabinet comme proactif et ça crée de la valeur ajoutée.', usage:'Service client additionnel'},
                              {profile:'Agent immobilier', icon:'solar:home-smile-angle-linear', color:'#0891B2', quote:'Avant une mise en vente, je propose systématiquement ce diagnostic. Ça me permet d\'anticiper les objections sur la performance énergétique et de valoriser le bien si les résultats sont bons.', usage:'Valorisation avant cession'},
                          ].map((c, i) => (
                              <div key={i} className="bg-white rounded-xl p-6 border border-slate-100 hover:border-[#1E3A5F]/30 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 group">
                                  <div className="flex items-center gap-3 mb-4">
                                      <div className="w-12 h-12 rounded-full flex items-center justify-center transition-transform group-hover:scale-110" style={{backgroundColor:c.color+'15'}}>
                                          <iconify-icon icon={c.icon} style={{fontSize:'24px', color:c.color}} />
                                      </div>
                                      <div>
                                          <p className="text-sm font-bold text-slate-900">{c.profile}</p>
                                          <p className="text-xs text-slate-500">{c.usage}</p>
                                      </div>
                                  </div>
                                  <p className="text-sm text-slate-600 italic leading-relaxed">"{c.quote}"</p>
                              </div>
                          ))}
                      </div>
                  </div>
              </section>

              {/* SECTION 8 - FAQ */}
              <section className="bg-white py-16">
                  <div className="max-w-4xl mx-auto px-4">
                      <SectionTitle>Questions fréquentes</SectionTitle>
                      <div className="space-y-3">
                          {[
  {q:'C\'est vraiment gratuit ?', r:'Oui. Le diagnostic est gratuit et sans engagement. Il sert à vous donner un premier niveau de lecture avant un éventuel audit complet.'},
  {q:'Est-ce un audit réglementaire ?', r:'Non. C’est une estimation directionnelle basée sur vos données déclaratives et des références sectorielles tertiaires. Pour un audit réglementaire, un bureau d’études certifié reste nécessaire.'},
  {q:'Je n’ai pas mes factures, est-ce utile ?', r:'Oui. L’outil peut générer une estimation à partir de votre activité, de la surface et de la période de construction.'},
  {q:'Je suis locataire, à quoi ça me sert ?', r:'Le rapport vous aide à objectiver la discussion avec le propriétaire avec des ordres de grandeur sur les surcoûts, les priorités et le ROI des actions.'}
].map((faq, i) => (
                              <details key={i} className="group border border-slate-200 rounded-xl overflow-hidden">
                                  <summary className="cursor-pointer px-5 py-4 bg-white hover:bg-slate-50 flex items-center justify-between font-medium text-sm text-slate-900">
                                      {faq.q}
                                      <iconify-icon icon="solar:alt-arrow-down-linear" className="group-open:rotate-180 transition-transform" style={{fontSize:'18px', color:'#94A3B8'}} />
                                  </summary>
                                  <div className="px-5 py-4 bg-slate-50 border-t border-slate-100">
                                      <p className="text-sm text-slate-600 leading-relaxed">{faq.r}</p>
                                  </div>
                              </details>
                          ))}
                      </div>
                  </div>
              </section>

          

              {/* SECTION 10 - GARANTIES */}
              <section className="bg-white py-12">
                  <div className="max-w-6xl mx-auto px-4">
                      <h3 className="text-lg font-semibold text-center text-slate-900 mb-8">Nos engagements</h3>
                      <div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
                          {[
                          {icon:'solar:database-linear', color:'#0891B2', title:'Basé sur données publiques', desc:'Sources ADEME et observatoires régionaux. Références sectorielles vérifiables et mises à jour régulièrement.'},
                          {icon:'solar:bolt-circle-linear', color:'#F39C12', title:'Résultat immédiat', desc:"Pas de rendez-vous. Pas d'attente. Rapport PDF téléchargeable en 3 minutes."},
                          {icon:'solar:hand-shake-linear', color:'#2ECC71', title:'Gratuit et sans engagement', desc:'Aucun paiement. Aucune obligation. Vous décidez si vous voulez aller plus loin.'},
                          {icon:'solar:user-check-linear', color:'#1E3A5F', title:'Utilisation claire des données', desc:'Vos données peuvent être partagées avec des partenaires qualifiés si vous le souhaitez. Contrôle total sur vos choix.'}
                        ].map((g, i) => (
                              <div key={i} className="text-center p-5 rounded-xl border border-slate-100 hover:border-slate-200 transition-colors">
                                  <div className="w-12 h-12 rounded-xl flex items-center justify-center mx-auto mb-3" style={{backgroundColor:g.color+'15'}}>
                                      <iconify-icon icon={g.icon} style={{fontSize:'24px', color:g.color}}></iconify-icon>
                                  </div>
                                  <h4 className="text-sm font-semibold text-slate-900 mb-1">{g.title}</h4>
                                  <p className="text-xs text-slate-600 leading-relaxed">{g.desc}</p>
                              </div>
                          ))}
                      </div>
                  </div>
              </section>

              {/* SECTION 11 - CTA FINAL */}
              <section className="bg-gradient-to-br from-[#2ECC71] to-[#27AE60] py-16">
                  <div className="max-w-4xl mx-auto px-4 text-center">
                      <h2 className="text-3xl tracking-tight font-semibold text-white mb-3">Prêt à savoir combien vous pourriez économiser chaque année ?</h2>
                      <p className="text-lg text-white/90 mb-8">3 minutes. Gratuit. Sans engagement.</p>
                      <button type="button" onClick={() => navigate('diagnostic')} className="bg-white text-[#2ECC71] font-semibold px-12 py-4 rounded-xl hover:bg-slate-50 transition-all shadow-xl text-base inline-flex items-center gap-2">
                          Lancer mon diagnostic énergétique <iconify-icon icon="solar:arrow-right-linear" style={{fontSize:'20px'}}></iconify-icon>
                      </button>
                      <div className="flex flex-wrap justify-center gap-6 text-sm text-white/80 mt-6">
                          <span className="flex items-center gap-1"><iconify-icon icon="solar:check-circle-bold" style={{fontSize:'16px'}}></iconify-icon> 1 247 diagnostics ce mois</span>
                          <span className="flex items-center gap-1"><iconify-icon icon="solar:check-circle-bold" style={{fontSize:'16px'}}></iconify-icon> Note moyenne 4.8/5</span>
                          <span className="flex items-center gap-1"><iconify-icon icon="solar:check-circle-bold" style={{fontSize:'16px'}}></iconify-icon> Déjà 4,2M€ identifiés</span>
                      </div>
                      <p className="text-xs text-white/60 mt-4">En continuant, vous acceptez notre politique de confidentialité. Désinscription en 1 clic.</p>
                  </div>
              </section>
          </div>
      );

   const PageMethod = ({ navigate }) => (
  <div className="fade-in">
    {/* HERO */}
    <section className="bg-gradient-to-b from-[#F8F9FA] to-white py-16 md:py-20 px-4">
      <div className="max-w-5xl mx-auto text-center">
        <div className="inline-flex items-center gap-2 bg-[#EEF2FF] text-[#1E3A5F] px-3 py-1 rounded-full text-xs font-semibold mb-4">
          <Icon icon="solar:shield-check-linear" /> Notre approche
        </div>
        <h1 className="text-3xl md:text-4xl tracking-tight font-semibold text-[#1E3A5F] mb-4">
          Une estimation utile pour décider
        </h1>
        <p className="text-[#6B7280] max-w-3xl mx-auto leading-relaxed">
          DiagTertiaire n’est pas un audit réglementaire. C’est un outil de cadrage rapide pour les bâtiments tertiaires :
          il vous aide à comprendre si votre consommation est cohérente, où se trouvent les principaux leviers,
          et si un audit complet vaut la peine d’être lancé maintenant.
        </p>

        <div className="mt-8 flex flex-wrap justify-center gap-3">
          <button
            type="button"
            onClick={() => navigate('diagnostic')}
            className="bg-[#1E3A5F] text-white px-6 py-3 rounded-xl text-sm font-semibold hover:bg-[#162B47] shadow-sm inline-flex items-center gap-2"
          >
            Lancer mon diagnostic <Icon icon="solar:arrow-right-linear" className="text-base" />
          </button>
          <button
            type="button"
            onClick={() => navigate('exemple')}
            className="bg-white border border-slate-300 text-slate-700 px-6 py-3 rounded-xl text-sm font-semibold hover:bg-slate-50"
          >
            Voir un exemple de rapport
          </button>
        </div>
      </div>
    </section>

    {/* POUR QUI / POUR QUOI */}
    <section className="bg-white py-14 px-4 border-y border-slate-100">
      <div className="max-w-6xl mx-auto grid md:grid-cols-2 gap-6">
        <div className="bg-slate-50 rounded-2xl border border-slate-200 p-6">
          <div className="flex items-center gap-2 mb-3 text-[#1E3A5F]">
            <Icon icon="solar:target-linear" className="text-xl" />
            <h2 className="text-lg font-semibold">Ce que l’outil permet</h2>
          </div>
          <ul className="space-y-2 text-sm text-slate-600">
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Comparer votre bâtiment à une <strong>référence tertiaire adaptée</strong> à votre activité</span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Obtenir un <strong>ordre de grandeur</strong> de votre consommation et de votre classe énergétique estimée</span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Identifier 3 actions prioritaires avec <strong>gains, coûts, ROI et aides indicatives</strong></span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:check-circle-bold" style={{color:'#2ECC71', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Préparer une discussion avec un bureau d’études, un propriétaire, ou un décideur interne</span>
            </li>
          </ul>
        </div>

        <div className="bg-rose-50 rounded-2xl border border-rose-200 p-6">
          <div className="flex items-center gap-2 mb-3 text-rose-700">
            <Icon icon="solar:danger-triangle-linear" className="text-xl" />
            <h2 className="text-lg font-semibold">Ce que l’outil ne remplace pas</h2>
          </div>
          <ul className="space-y-2 text-sm text-slate-700">
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:close-circle-bold" style={{color:'#E74C3C', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Un audit énergétique réglementaire ou une mission de maîtrise d’œuvre</span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:close-circle-bold" style={{color:'#E74C3C', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Un dimensionnement technique (CVC, ECS, ventilation, GTB, etc.)</span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:close-circle-bold" style={{color:'#E74C3C', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Un engagement contractuel sur les économies réelles ou les aides mobilisables</span>
            </li>
            <li className="flex items-start gap-2">
              <iconify-icon icon="solar:close-circle-bold" style={{color:'#E74C3C', fontSize:'16px', marginTop:'2px'}}></iconify-icon>
              <span>Une analyse complète de conformité (Décret Tertiaire, obligations réglementaires, etc.)</span>
            </li>
          </ul>
        </div>
      </div>
    </section>

    {/* COMMENT ON CALCULE */}
    <section className="bg-[#F8F9FA] py-16 px-4">
      <div className="max-w-6xl mx-auto">
        <SectionTitle sub="Une logique simple, transparente et orientée décision">
          Comment l’estimation est construite
        </SectionTitle>

        <div className="grid md:grid-cols-4 gap-5">
          {[
            {
              icon: 'solar:buildings-2-linear',
              color: '#1E3A5F',
              title: '1. Référence sectorielle',
              desc: "Chaque activité tertiaire a une consommation 'normale' différente. Un hôtel, un bureau et un commerce ne se comparent pas de la même manière."
            },
            {
              icon: 'solar:calendar-linear',
              color: '#F39C12',
              title: '2. Ajustement bâtiment',
              desc: "La période de construction et l'âge du chauffage ajustent l'estimation pour refléter les écarts de performance les plus courants."
            },
            {
              icon: 'solar:wallet-money-linear',
              color: '#2ECC71',
              title: '3. Conversion en coût',
              desc: "Les consommations sont valorisées avec des prix unitaires indicatifs pour donner une lecture économique immédiate."
            },
            {
              icon: 'solar:chart-2-linear',
              color: '#7B3F9E',
              title: '4. Priorisation des actions',
              desc: "Le rapport propose des postes d'amélioration type (enveloppe, pilotage, chauffage, LED) avec gains, coûts et ROI indicatifs."
            }
          ].map((item, i) => (
            <div key={i} className="bg-white rounded-xl border border-slate-200 p-5">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center mb-3" style={{backgroundColor:item.color + '15'}}>
                <iconify-icon icon={item.icon} style={{fontSize:'24px', color:item.color}}></iconify-icon>
              </div>
              <h3 className="text-sm font-semibold text-slate-900 mb-2">{item.title}</h3>
              <p className="text-xs text-slate-600 leading-relaxed">{item.desc}</p>
            </div>
          ))}
        </div>

        <div className="mt-8 grid md:grid-cols-2 gap-5">
          <div className="bg-white rounded-xl border border-slate-200 p-5">
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Exemple concret de logique</h3>
            <p className="text-sm text-slate-600 leading-relaxed mb-3">
              Un bureau à 180 kWh/m²/an peut être cohérent selon son âge et ses équipements.
              Le même niveau sur un bâtiment récent peut signaler une marge de progrès.
            </p>
            <p className="text-sm text-slate-600 leading-relaxed">
              L’objectif n’est pas de “coller une note”, mais de vous donner une base de décision :
              <strong> faut-il investiguer, prioriser, ou agir maintenant ?</strong>
            </p>
          </div>

          <div className="bg-white rounded-xl border border-slate-200 p-5">
            <h3 className="text-sm font-semibold text-[#1E3A5F] mb-3">Si vous n’avez pas vos factures</h3>
            <p className="text-sm text-slate-600 leading-relaxed mb-2">
              L’outil peut générer une estimation par défaut à partir de votre activité, surface et période de construction.
            </p>
            <p className="text-sm text-slate-600 leading-relaxed">
              C’est utile pour un premier tri, mais la précision s’améliore fortement dès que vous renseignez vos consommations réelles.
            </p>
          </div>
        </div>
      </div>
    </section>

    {/* SOURCES / HYPOTHESES */}
    <section className="bg-white py-16 px-4">
      <div className="max-w-6xl mx-auto">
        <SectionTitle sub="Pour rester crédible, l’outil doit aussi expliciter ses limites">
          Sources, hypothèses et limites
        </SectionTitle>

        <div className="grid md:grid-cols-3 gap-5">
          <div className="rounded-xl border border-slate-200 p-5 bg-slate-50">
            <div className="flex items-center gap-2 mb-2 text-[#1E3A5F]">
              <Icon icon="solar:database-linear" className="text-lg" />
              <h3 className="text-sm font-semibold">Références utilisées</h3>
            </div>
            <p className="text-xs text-slate-600 leading-relaxed">
              Références tertiaires issues de bases publiques et de retours terrain, structurées par typologie d’activité
              (bureaux, commerce, hôtellerie, santé, enseignement, etc.).
            </p>
          </div>

          <div className="rounded-xl border border-slate-200 p-5 bg-slate-50">
            <div className="flex items-center gap-2 mb-2 text-[#1E3A5F]">
              <Icon icon="solar:calculator-linear" className="text-lg" />
              <h3 className="text-sm font-semibold">Hypothèses de calcul</h3>
            </div>
            <p className="text-xs text-slate-600 leading-relaxed">
              Les coûts travaux, gains potentiels et aides sont des fourchettes indicatives. Ils varient selon l’état réel du bâtiment,
              l’exploitation, les devis et les dispositifs disponibles au moment du projet.
            </p>
          </div>

          <div className="rounded-xl border border-slate-200 p-5 bg-slate-50">
            <div className="flex items-center gap-2 mb-2 text-[#1E3A5F]">
              <Icon icon="solar:scale-linear" className="text-lg" />
              <h3 className="text-sm font-semibold">Niveau de précision</h3>
            </div>
            <p className="text-xs text-slate-600 leading-relaxed">
              Le rapport est une <strong>estimation directionnelle</strong> (ordre de grandeur). Il sert à prioriser et cadrer.
              Pour engager des budgets, un audit ou une visite technique reste indispensable.
            </p>
          </div>
        </div>

        <div className="mt-8 bg-amber-50 border border-amber-200 rounded-xl p-5">
          <div className="flex items-start gap-3">
            <iconify-icon icon="solar:info-circle-linear" style={{fontSize:'20px', color:'#D97706', marginTop:'2px'}}></iconify-icon>
            <div>
              <p className="text-sm font-semibold text-amber-900 mb-1">Point important</p>
              <p className="text-xs text-amber-800 leading-relaxed">
                Les prix de l’énergie, aides et coûts d’intervention évoluent. Le rapport a vocation à vous orienter rapidement,
                pas à se substituer à un chiffrage entreprise par entreprise.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    {/* POUR QUI */}
    <section className="bg-[#F8F9FA] py-16 px-4">
      <div className="max-w-6xl mx-auto">
        <SectionTitle sub="Différents profils, même besoin : décider plus vite avec de meilleurs repères">
          À qui s’adresse DiagTertiaire
        </SectionTitle>

        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-5">
          {[
            {
              icon:'solar:buildings-linear',
              title:'Propriétaires',
              desc:'Évaluer rapidement un actif, arbitrer entre attente, audit ou travaux.'
            },
            {
              icon:'solar:briefcase-linear',
              title:'Locataires exploitants',
              desc:'Objectiver une demande de travaux et sortir du simple ressenti.'
            },
            {
              icon:'solar:case-round-minimalistic-linear',
              title:'Gestionnaires',
              desc:'Prioriser les sites à traiter dans un parc limité en budget.'
            },
            {
              icon:'solar:calculator-linear',
              title:'Prescripteurs',
              desc:'Experts-comptables, assureurs, agents : un outil utile pour qualifier un besoin.'
            }
          ].map((p, i) => (
            <div key={i} className="bg-white rounded-xl border border-slate-200 p-5">
              <div className="w-10 h-10 rounded-lg bg-[#1E3A5F]/10 flex items-center justify-center mb-3">
                <iconify-icon icon={p.icon} style={{fontSize:'20px', color:'#1E3A5F'}}></iconify-icon>
              </div>
              <h3 className="text-sm font-semibold text-slate-900 mb-2">{p.title}</h3>
              <p className="text-xs text-slate-600 leading-relaxed">{p.desc}</p>
            </div>
          ))}
        </div>
      </div>
    </section>

    {/* CTA FINAL */}
    <section className="bg-white py-16 px-4 border-t border-slate-100">
      <div className="max-w-4xl mx-auto">
        <div className="rounded-2xl bg-[#1E3A5F] text-white p-8 text-center shadow-xl">
          <h2 className="text-2xl tracking-tight font-semibold mb-2">
            Vous voulez un premier niveau de lecture fiable en 3 minutes ?
          </h2>
          <p className="text-sm text-blue-100 mb-6 max-w-2xl mx-auto">
            Lancez le diagnostic, récupérez votre rapport, puis décidez si vous devez approfondir avec un expert.
          </p>

          <div className="flex flex-col sm:flex-row gap-3 justify-center">
            <button
              type="button"
              onClick={() => navigate('diagnostic')}
              className="bg-white text-[#1E3A5F] px-6 py-3 rounded-xl text-sm font-semibold hover:bg-slate-100"
            >
              Démarrer maintenant
            </button>
            <button
              type="button"
              onClick={() => navigate('exemple')}
              className="bg-transparent border border-white/30 text-white px-6 py-3 rounded-xl text-sm font-semibold hover:bg-white/10"
            >
              Voir un rapport exemple
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>
);

      const PageExample = ({ navigate }) => {
          const FAKE_DATA = {
              activity: 'office', activityMixPct: 0, year: 'pre1975', surface: 450, levels: 2,
              heating: 'gas', heatingAge: '> 15 ans', occupation: 'semaine',
              consumptionMode: 'kwh', elecKwh: 45000, gasKwh: 146700,
              noData: false, works: [], hasWorks: 'no', ecsSystem: '',
              firstName: 'Jean', email: 'jean@exemple.com', consent: true
          };

          return (
              <div className="fade-in bg-[#F8F9FA] min-h-screen">
                  <div className="py-12 text-center px-4">
                      <h1 className="text-3xl tracking-tight font-semibold text-[#1E3A5F] mb-2">À quoi ressemble votre rapport ?</h1>
                      <p className="text-[#6B7280]">Exemple pour un bureau de 450m² construit avant 1975.</p>
                  </div>
                  <div className="max-w-4xl mx-auto px-4 pb-12">
                      <StepReport data={FAKE_DATA} />
                  </div>
              </div>
          );
      };

      const PagePro = ({ navigate }) => (
          <div className="fade-in">
              <section className="bg-[#1E3A5F] py-20 text-center text-white px-4">
                  <h1 className="text-4xl tracking-tight font-semibold mb-4">Pour les professionnels du chiffre</h1>
                  <p className="text-lg text-blue-200 max-w-2xl mx-auto mb-8">
                      Proposez un outil de cadrage énergétique à vos clients tertiaires (comptables, notaires, assureurs).
                  </p>
                  <a
  href={CTA_CALENDLY_URL}
  target="_blank"
  rel="noopener noreferrer"
  className="block w-full bg-white text-[#1E3A5F] font-semibold text-center py-3 rounded-lg hover:bg-slate-100 transition-colors"
>
  📅 Réserver mon rendez-vous →
</a>
              </section>
          </div>
      );

      const RestoreBanner = ({ onDismiss, onRestart }) => (
          <div className="w-full bg-[#EEF2FF] border-b border-[#1E3A5F]/20 px-4 py-2.5 flex items-center justify-between gap-4 no-print">
              <div className="flex items-center gap-2 text-[#1E3A5F] text-sm">
                  <Icon icon="solar:history-linear" className="shrink-0 text-base" />
                  <span className="font-medium">Reprendre votre estimation en cours ?</span>
              </div>
              <div className="flex items-center gap-3">
                  <button type="button" onClick={onRestart} className="text-xs font-semibold text-red-600 hover:text-red-800 underline">Effacer</button>
                  <button type="button" onClick={onDismiss} className="text-slate-400 hover:text-slate-600">
                      <Icon icon="solar:close-circle-linear" className="text-base" />
                  </button>
              </div>
          </div>
      );

      /* --- APP ROOT --- */
      const App = () => {
          const [currentPage, setCurrentPage] = useState('home');
          const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
          const [diagStep, setDiagStep] = useState(1);
          const [showRestoreBanner, setShowRestoreBanner] = useState(false);

          const [formData, setFormData] = useState(() => {
              const saved = loadFromLS();
              return (saved && saved._hasData) ? { ...DEFAULT_FORM, ...saved } : { ...DEFAULT_FORM };
          });

          useEffect(() => {
              const saved = loadFromLS();
              if (saved && saved._hasData) setShowRestoreBanner(true);
          }, []);

          const saveTimeout = useRef(null);
          useEffect(() => {
              if (saveTimeout.current) clearTimeout(saveTimeout.current);
              saveTimeout.current = setTimeout(() => {
                  const hasData = !!(formData.address || formData.activity || formData.year);
                  if (hasData) saveToLS({ ...formData, _hasData: true });
              }, 600);
              return () => { if (saveTimeout.current) clearTimeout(saveTimeout.current); };
          }, [formData]);

          const updateForm = useCallback((field, value) => {
              setFormData(prev => ({ ...prev, [field]: value }));
          }, []);

          const handleRestart = () => {
              clearLS();
              setFormData({ ...DEFAULT_FORM });
              setDiagStep(1);
              setShowRestoreBanner(false);
          };

          const navigate = (page) => {
              setCurrentPage(page);
              setIsMobileMenuOpen(false);
              window.scrollTo(0, 0);
          };

          const NavLink = ({ page, label }) => (
              <button type="button"
                  onClick={() => navigate(page)}
                  className={`text-sm font-medium transition-colors ${currentPage === page ? 'text-[#1E3A5F] font-semibold border-b-2 border-[#1E3A5F]' : 'text-[#6B7280] hover:text-[#1E3A5F]'}`}
              >
                  {label}
              </button>
          );

          return (
              <div className="min-h-screen flex flex-col">
                  {showRestoreBanner && <RestoreBanner onDismiss={() => setShowRestoreBanner(false)} onRestart={handleRestart} />}

                  <nav className="bg-white border-b border-slate-200 sticky top-0 z-50">
                      <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                          <div className="flex items-center gap-2 text-[#1E3A5F] cursor-pointer" onClick={() => navigate('home')}>
                              <Icon icon="solar:buildings-2-linear" />
                              <span className="font-semibold text-lg">DiagTertiaire</span>
                          </div>

                          <div className="hidden md:flex gap-8">
                              <NavLink page="home" label="Accueil" />
                              <NavLink page="methode" label="Approche" />
                              <NavLink page="exemple" label="Rapport" />
                              <NavLink page="pro" label="Espace Pro" />
                          </div>

                          <div className="hidden md:block">
                              <button type="button" onClick={() => navigate('diagnostic')} className="bg-[#1E3A5F] text-white px-4 py-2 rounded-lg text-xs font-semibold hover:bg-[#162B47]">
                                  Démarrer →
                              </button>
                          </div>

                          <button type="button" className="md:hidden text-[#1E3A5F]" onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
                              <Icon icon={isMobileMenuOpen ? "solar:close-square-linear" : "solar:hamburger-menu-linear"} />
                          </button>
                      </div>

                      {isMobileMenuOpen && (
                          <div className="md:hidden bg-white border-t border-slate-100 p-4 flex flex-col gap-4">
                              <NavLink page="home" label="Accueil" />
                              <NavLink page="methode" label="Notre approche" />
                              <NavLink page="exemple" label="Exemple de rapport" />
                              <NavLink page="pro" label="Espace Pro" />
                          </div>
                      )}
                  </nav>

                  <main className="flex-1">
                      {currentPage === 'home' && <PageHome navigate={navigate} />}

                      {currentPage === 'diagnostic' && (
                          <div className="max-w-4xl mx-auto px-4 py-8">
                              {diagStep < 4 && <Stepper currentStep={diagStep} />}

                              {diagStep === 1 && <StepBuilding data={formData} update={updateForm} onNext={() => setDiagStep(2)} />}
                              {diagStep === 2 && <StepEnergy data={formData} update={updateForm} onNext={() => setDiagStep(3)} onBack={() => setDiagStep(1)} />}
                              {diagStep === 3 && <StepLead data={formData} update={updateForm} onNext={() => setDiagStep(4)} onBack={() => setDiagStep(2)} />}
                              {diagStep === 4 && <StepReport data={formData} />}
                          </div>
                      )}

                      {currentPage === 'methode' && <PageMethod navigate={navigate} />}
                      {currentPage === 'exemple' && <PageExample navigate={navigate} />}
                      {currentPage === 'pro' && <PagePro navigate={navigate} />}
                  </main>

                  {currentPage !== 'diagnostic' && (
                      <footer className="bg-[#1E3A5F] py-12">
          <div className="max-w-6xl mx-auto px-4">
            <div className="grid md:grid-cols-4 gap-8 mb-8">
              
              <div>
                <div className="flex items-center gap-2 mb-4">
                  <div className="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center">
                    <iconify-icon icon="solar:buildings-2-linear" style={{color:'white', fontSize:'18px'}} />
                  </div>
                  <span className="font-bold text-white">DiagTertiaire</span>
                </div>
                <p className="text-sm text-slate-400 leading-relaxed mb-4">Estimation directionnelle basée sur valeurs de référence sectorielles</p>
                <div className="space-y-2">
                  <button type="button" onClick={() => navigate('home')} className="block text-sm text-slate-300 hover:text-white transition-colors">À propos</button>
                  <button type="button" className="block text-sm text-slate-300 hover:text-white transition-colors">Notre méthodologie</button>
                  <a href="mailto:contact@diagtertiaire.fr" className="block text-sm text-slate-300 hover:text-white transition-colors">Contact</a>
                </div>
              </div>

              <div>
                <h4 className="text-sm font-bold text-white mb-3">Ressources</h4>
                <ul className="space-y-2">
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Guide du décret tertiaire</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Références ADEME</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Blog</button></li>
                  <li><button type="button" onClick={() => navigate('exemple')} className="text-sm text-slate-300 hover:text-white transition-colors">Exemple de rapport</button></li>
                </ul>
              </div>

              <div>
                <h4 className="text-sm font-bold text-white mb-3">Légal</h4>
                <ul className="space-y-2">
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Mentions légales</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Politique de confidentialité</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">CGU</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Gestion des cookies</button></li>
                </ul>
              </div>

              <div>
                <h4 className="text-sm font-bold text-white mb-3">Professionnel</h4>
                <ul className="space-y-2">
                  <li><button type="button" onClick={() => navigate('pro')} className="text-sm text-slate-300 hover:text-white transition-colors">Espace pro</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">Devenir partenaire</button></li>
                  <li><button type="button" className="text-sm text-slate-300 hover:text-white transition-colors">API & Intégrations</button></li>
                </ul>
              </div>
            </div>

            <div className="pt-6 border-t border-white/10 flex flex-wrap justify-between items-center gap-4">
              <p className="text-xs text-slate-400">© 2026 DiagTertiaire • Estimations basées sur données ADEME</p>
              <div className="flex items-center gap-3">
                {['SSL','RGPD','🇫🇷 FR'].map((b, i) => (
                  <span key={i} className="text-xs text-slate-400 bg-white/5 px-2 py-1 rounded">{b}</span>
                ))}
              </div>
            </div>
          </div>
        </footer>
                  )}
              </div>
          );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  
</body></html>
  